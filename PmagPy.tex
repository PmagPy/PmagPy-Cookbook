\documentclass[11pt]{book}
\usepackage{graphicx}
\usepackage[usenames]{color}
%\usepackage{enumitem}
%\usepackage{stylemydefs}
%\input epsf
\usepackage{natbib}
%\usepackage{appendix}
\usepackage{bm}
\usepackage{amssymb}

\usepackage[utf8]{inputenc}
%\DeclareUnicodeCharacter{00A0}{ }
%\usepackage{rotating}
%\usepackage{longtable}

% for book only:

%\usepackage[left=1in,right=1in,bottom=1.25in,top=1.25in]{geometry}

%\usepackage{makeidx}
%\makeindex

%\usepackage{fancyhdr}/manual

%\pagestyle{fancy}
%\fancyhf{}
%\fancyfoot[C]{\thepage}
%\fancyhead[LO]{\bfseries\rightmark}
%\fancyhead[RE]{\bfseries\leftmark}
%


\usepackage{hyperref}
\begin{document}
 \setcounter{tocdepth}{3}
\tableofcontents

 % comment out the line below for the pdf version and comment out all lines that have the command \customlink
\input{customlinks} % comment

{\hskip 1in \includegraphics[width=10cm]{EPSFiles/logo.eps}

 \title{PmagPy Cookbook}

 \maketitle
\noindent Dear Reader,

This documentation is updated from that in the book entitled {\it Essentials of Paleomagnetism} by  Tauxe et al., (2010). \nocite{tauxe10}  This cookbook was designed as a companion website to the book \href{http://earthref.org/MAGIC/books/Tauxe/Essentials/WebBook3.html}{Essentials of Paleomagnetism, 5th Web Edition}. Chapter references to this companion book are, for example, ``Essentials Chapter 1''.

There are many chefs who contributed to this work, in particular, the MagIC Database Team (Cathy Constable, Anthony Koppers, Rupert Minnett, Nick Jarboe, Ron Shaar, and Lori Jonestrask). Nick Swanson-Hysell (UC Berkeley) contributed the demag\_gui and Jupyter notebook documentation. The PmagPy project is supported by grants from the National Science Foundation.

%A pdf version of this cookbook is available for download at:  \href{https://github.com/PmagPy/PmagPy-Cookbook/blob/gh-pages/PmagPy.pdf}{PmagPy.pdf}.

Users of PmagPy should cite the open access article:

  \href{http://dx.doi.org/10.1002/2016GC006307}{Tauxe, L., R. Shaar, L. Jonestrask,
N. L. Swanson-Hysell, R. Minnett,
A. A. P. Koppers, C. G. Constable,
N. Jarboe, K. Gaastra, and L. Fairchild
(2016), PmagPy: Software package for
paleomagnetic data analysis and a
bridge to the Magnetics Information
Consortium (MagIC) Database,
Geochem. Geophys. Geosyst., 17,
doi:10.1002/2016GC006307.}

{\obeylines
 Lisa Tauxe and Lori Jonestrask
 Scripps Institution of Oceanography
 La Jolla, CA 92093
 \today
  \url{http://magician.ucsd.edu/}
 }

\customlink{quick_start}


\chapter{Installing {\bf PmagPy}}

%To skip all the details and just start using \href{#pmag_gui.py}{Pmag GUI} or \href{#magic_gui.py}{MagIC GUI} to upload data into the \href{#MagICDatabase}{MagIC database}, or to analyze using \href{#thellier_GUI.py}{Thellier GUI} or \href{#DemagGUI}{Demag GUI}, start here.
You have multiple options for  using PmagPy.

\begin{itemize}
\item If you only want to use the graphical user interfaces (GUIs), you can download them as  \href{#standalone}{standalone programs}.  The standalone install doesn't require that you have Python, but is more limited than the full PmagPy install.

\end{itemize}

If you want the full {\bf PmagPy} functionality, you have two options:

\begin{itemize}

  \item You can use pip to download and install the {\bf PmagPy} function library and the \href{#full_install}{{\bf PmagPy} command line} programs.

  \item If you want to actively participate in developing and modifying {\bf PmagPy}, you will do a \href{#full_install} {developer install}.
\end{itemize}

Alternatively, if you are familiar with Jupyter Notebooks and Python, you may want to use the pmagpy package without downloading anything, you should go to the our online option:
\begin{itemize}
\item If you do not have an earthref account, go to \href{https://earthref.org/log-in} {https://earthref.org/log-in} and create an account with your ORCID.  If you do not have one of those, you need to get one.  
\item Once you have logged in, go to the website: \href{https://jupyterhub.earthref.org}{https://jupyterhub.earthref.org} and login with your earthref account
\item Click on the `PmagPy Online - Setup.ipynb'  link and follow the instructions.  
\item To learn more about Jupyter notebooks and Python, check out the online class for Earth Scientists: \href{https://github.com/ltauxe/Python-for-Earth-Science-Students}{https://github.com/ltauxe/Python-for-Earth-Science-Students}
\end{itemize}


\customlink{standalone}
\section{Standalone GUI download}

If you do not need the full PmagPy functionality, and you only want to use Pmag GUI, MagIC GUI, Thellier GUI, and Demag GUI, there is now a standalone download for you.  You won't need to install Python for this.

%\noindent Follow the download instructions in the provided links, and then you can go straight to using \href{#pmag_gui.py}{Pmag GUI} or \href{#magic_gui.py}{MagIC GUI}.  The standalone versions of these applications are still in development; please report problems to the PmagPy team by creating \href{https://github.com/PmagPy/PmagPy/issues/}{an issue on Github}.  Note that these standalone programs can be slow to boot up: please be patient!

\subsection{OSX Standalone download}

\noindent You will find the latest OS X standalone download here: \href{https://github.com/PmagPy/PmagPy-Standalone-OSX/releases/latest}{https://github.com/PmagPy/PmagPy-Standalone-OSX/releases/latest}

\subsection{Windows Standalone download}

\noindent You will find the latest Windows standalone download here: \href{https://github.com/PmagPy/PmagPy-Standalone-Windows/releases/latest}{https://github.com/PmagPy/PmagPy-Standalone-Windows/releases/latest}

\subsection{Linux Standalone download}

This binary has only been tested on a Ubuntu 14.04 (Trusty) distribution and might be buggy on other distributions.

\noindent You will find the latest Linux standalone download: \href{https://github.com/PmagPy/PmagPy-Standalone-Linux/releases/latest}{https://github.com/PmagPy/PmagPy-Standalone-Linux/releases/latest}


\customlink{full_install}
\customlink{getting_python}

%\setcounter{tocdepth}{1}
%\tableofcontents


\section{Full PmagPy install and update}


If you have previously downloaded Canopy Python, you will need to uninstall it following \href{https://support.enthought.com/hc/en-us/articles/204469700-Uninstalling-and-resetting-Canopy}{these directions}.

Next, choose whether you want a developer install or a default (pip) install.  If you want to get into the nitty-gritty of the code, you should do a developer install.  However, the developer install may be buggier.  If you just want to use {\bf PmagPy} out of the box, do a regular pip install.  *Note*: you cannot have both a developer install and a pip install.  If you want to do a developer install, make sure you uninstall pmagpy/pmagpy-cli first if you have already installed them.

Next, choose install instructions based on your preferred install method (pip/developer) and your operating system (OSX/Windows/Linux).

\href{https://earthref.org/PmagPy/cookbook/osx_pip.html}{OSX pip}

\href{https://earthref.org/PmagPy/cookbook/windows_pip.html}{Windows pip}

\href{https://earthref.org/PmagPy/cookbook/linux_pip.html}{Linux pip}

\href{https://earthref.org/PmagPy/cookbook/osx_developer.html}{OSX developer}

\href{https://earthref.org/PmagPy/cookbook/windows_developer.html}{Windows developer}

\href{https://earthref.org/PmagPy/cookbook/linux_developer.html}{Linux developer}

\section{Install help}

Check out our guidelines on \href{https://github.com/PmagPy/PmagPy/blob/master/CONTRIBUTING.md}{how to contribute to PmagPy} for information on how to raise issues, request features, and make pull requests.


\customlink{setting_path}
\subsection{Details of setting your PATH}
Here are the details of what the developer install script actually does.  For OS X and Linux, it adds these lines editing \$PATH to your .bashrc file (on OS X Catalina, you may need to use .zshrc instead, see more info below):

\begin{verbatim}
    export PATH=/Users/***/Desktop/PmagPy/programs:$PATH
    export PATH=/Users/***/Desktop/PmagPy/programs/conversion_scripts:$PATH
\end{verbatim}

And this line to your \$PYTHONPATH to your .bashrc file:

\begin{verbatim}
    export PYTHONPATH=$PYTHONPATH:/Users/***/Desktop/PmagPy/
\end{verbatim}


where *** is your username.  (Of course, these lines will depend on exactly where you have put your PmagPy folder -- if it lives on your home directory, your \$PATH will point there:
\begin{verbatim}
    export PATH=/Users/***/PmagPy/programs
\end{verbatim}

If you are using Z shell instead of bash (which is the new default for Mac starting with OSX Catalina), you will need to manually add the same \$PATH and \$PYTHONPATH lines to .zshrc instead of .bashrc.  You can determine which shell you are using by looking at the text at the top of your Terminal window.  For example, see below I am using bash:

\includegraphics[width=30cm]{EPSFiles/FigTerminal.eps}

For Windows, \$PATH and \$PYTHONPATH will be set in your \href{https://www.java.com/en/download/help/path.xml}{Control Panel (Environment Variables)}.

In Windows 10, this is done by opening Control Panel \verb|->| System and Security \verb|->| System \verb|->| Advanced system settings \verb|->| Environment Variables.  You can see details \href{https://www.java.com/en/download/help/path.xml}{here}.  Alternatively, just search for “environment variables” in the Windows 10 search bar select ``Edit the system environment variables''.

To make the needed edits, you will first add to your existing PATH variable or create a new PATH variable with the following values: \begin{verbatim}
  C:\Users\***\Desktop\PmagPy\programs\conversion_scripts
\end{verbatim}
and \begin{verbatim}
  C:\Users\***\Desktop\PmagPy\programs\conversion_scripts
\end{verbatim}
Next, add to your existing PYTHONPATH variable or create a new PYTHONPATH variable with: \begin{verbatim}
  C:\Users\***\Desktop\PmagPy
\end{verbatim}

Important: you will need to modify the above paths based on *your* username and the location where *you* have put the PmagPy folder.  So, if my username is limatango and I put PmagPy in my Downloads folder, my path would read: \begin{verbatim}
  C:\Users\limatango\Downloads\PmagPy
\end{verbatim}
and so on.

\subsection{Common install problems}

\begin{itemize}

\item Make sure you have the correct version of Python.  If you run the command ``python'', you should see a message like this:

\begin{verbatim}

Python 3.7.0 (default, Jun 28 2018, 07:39:16)
[Clang 4.0.1 (tags/RELEASE_401/final)] :: Anaconda, Inc. on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>>
\end{verbatim}
(Press control-D to exit)

If you have Python 2.7 or a non-Anaconda Python, you will need to go back and install Anaconda Python.  If you installed Canopy Python at any point, make sure you uninstall it first.


\item If you try to run a {\bf PmagPy} program and you get an ImportError, you are probably missing a required package.  Go back and install all required, non-default packages.  If the ImportError is for a {\bf PmagPy} package, go back and make sure you installed pmagpy and pmagpy-cli via pip or dev\_setup.py.

\item If you are trying to run PmagPy programs and you run into an issue with python vs pythonw, you may need to link your python to pythonw:
  \begin{verbatim}

    ln -s ~/anaconda3/bin/python3 ~/anaconda3/bin/pythonw

    \end{verbatim}

\end{itemize}

For more help, see the \href{#trouble}{troubleshooting section}.

\customlink{which_command}
    \subsection {OS-specific differences}
    We try to support all platforms, but there are some quirks that will affect how you invoke {\bf PmagPy} programs depending on your platform.  For OSX users with a pip install, you will invoke the GUIs with a special syntax:

\begin{verbatim}
  pmag_gui_anaconda
\end{verbatim}

For all platforms with a developer install:

\begin{verbatim}
  pmag_gui.py
\end{verbatim}

For Windows users with a pip install:

\begin{verbatim}
  pmag_gui
\end{verbatim}


If you see an error message like this:

\begin{verbatim}
  This program needs access to the screen.
  Please run with a Framework build of python, and only when you are
  logged in on the main display of your Mac.
\end{verbatim}

you need to use ``pmag\_gui\_anaconda''

If you see an error message like this:

\begin{verbatim}
  -bash: pmag_gui: command not found
\end{verbatim}

You are either using the wrong command for your operating system, or you haven't fully installed {\bf PmagPy}.

\customlink{notebook_quickstart}


\section{Quickstart with PmagPy notebooks}

Once you have installed {\bf PmagPy}, you may want to run the example notebooks.  You can copy example data\_files and launch the {\bf PmagPy} notebooks from your command line with the following:

\begin{verbatim}
    cd Desktop
    move_data_files.py
    cd PmagPy-data
    jupyter notebook
\end{verbatim}

The final command ({\bf jupyter notebook}) will open a browser window, and you can then click on the notebook you want to run (we recommend you start with PmagPy\_introduction.ipynb).

**Note**: You only have to do the move\_data\_files.py command once after initial installion and then once after each update.   You should make a copy of any notebook (see File menu) if you want to make any changes as each update will overwrite the standard notebooks.

\customlink{next_steps}
\section{Next steps}

Where do you want to go from here?

\begin{itemize}
\item \href{#magic_download}{Download data from the {\bf MagIC} database.}
\item \href{#pmag_gui.py}{Analyze and/or upload demagnetization} and/or paleointensity measurement data to the {\bf MagIC} database.
\item \href{#PmagPy}{Learn more about particular programs in the {\bf PmagPy} software package.}
\item \href{#MagICDatabase}{Learn about the MagIC Database.}
\item \href{#Python}{Learn how to write your own programs in Python.}
\item \href{#Notebooks}{Learn how to use Jupyter notebooks for managing your data analysis workflow.}
\end{itemize}



\customlink{PmagPy}
\chapter{The {\bf PmagPy} software package}
\label{chap:PmagPy}

The {\bf PmagPy} software package is a comprehensive set of programs for paleomagnetists and rock magnetists.  For installation,  follow the instructions in the \href{#quick_start}{Installing PmagPy} Chapter in this cookbook. \\

Some of the key programs for importing and interpreting paleomagnetic and rock magnetic data are packaged together in a program called {\href{#pmag_gui.py}{Pmag GUI}.

Here is a list of what {\bf PmagPy} can do.
  % For more information on any of the programs listed below, use the links in the following two sections.

Calculations:

\begin{itemize}

%\item \href{http://pmagpy.github.io/PmagPy.html#aarm_magic}{aarm\_magic} : takes a measurements.txt file with anisotropy of ARM data and calculates the tensors and stores in a specimens.txt file.
%\item \href{http://pmagpy.github.io/PmagPy.html#angle}{angle} : calculates the angle between two vectors
%\item \href{http://pmagpy.github.io/PmagPy.html#apwp}{apwp} : returns predicted paleolatitudes, directions and pole latitude/longitude from apparent polar wander paths of Besse and Courtillot (2002).
%\item \href{http://pmagpy.github.io/PmagPy.html#atrm_magic}{atrm\_magic} : takes a measurements.txt file with anisotropy of TRM data and calculates the tensors and stores in a specimens.txt file.
%\item \href{http://pmagpy.github.io/PmagPy.html#b_vdm}{b\_vdm} : converts B (in microT) and magnetic latitude to V(A)DM (see vdm\_b)
%\item \href{http://pmagpy.github.io/PmagPy.html#bootams}{bootams} : calculates bootstrap statistics for tensor data
%\item \href{http://pmagpy.github.io/PmagPy.html#cart_dir}{cart\_dir} : converts cartesian coordinates (x,y,z) to declination, inclination, intensity (see dir\_cart)
%\item \href{http://pmagpy.github.io/PmagPy.html#di_eq}{di\_eq} : maps declination, inclinatitions to X,Y for plotting in equal area projections
%\item \href{http://pmagpy.github.io/PmagPy.html#di_geo}{di\_geo} : rotates declination, inclination in specimen coordinates to geographic
%\item \href{http://pmagpy.github.io/PmagPy.html#di_rot}{di\_rot} : rotates directions to a  coordinate system with D,I as center
%\item \href{http://pmagpy.github.io/PmagPy.html#di_tilt}{di\_tilt} : rotates directions to stratigraphic coordinates
%\item \href{http://pmagpy.github.io/PmagPy.html#di_vgp}{di\_vgp} : converts direction to Virtual Geomagnetic Pole (see vgp\_di)
%\item \href{http://pmagpy.github.io/PmagPy.html#dia_vgp}{dia\_vgp} : converts direction and alpha95 to Virtual Geomagnetic Pole and dp,dm
%\item \href{http://pmagpy.github.io/PmagPy.html#dipole_pinc}{dipole\_pinc} : calculates inclination given latitude assuming geocentric axial dipole
%\item \href{http://pmagpy.github.io/PmagPy.html#dipole_plat}{dipole\_plat} : calculates latitude given inclination assuming geocentric axial dipole
%\item \href{http://pmagpy.github.io/PmagPy.html#dir_cart}{dir\_cart} : converts declination, inclination, intensity to cartesian coordinates (see cart\_dir)
%\item \href{http://pmagpy.github.io/PmagPy.html#eigs_s}{eigs\_s} : converts eigenparameters to equivalent 6 element tensor (see s\_eigs)
%\item \href{http://pmagpy.github.io/PmagPy.html#eq_di}{eq\_di} : takes X,Y from equal area projection (e.g., from digitized coordinates and  converts to declination, inclination)
%\item \href{http://pmagpy.github.io/PmagPy.html#fcalc}{fcalc} : returns the value from an F table, given the degrees of freedom.
%\item \href{http://pmagpy.github.io/PmagPy.html#fisher}{fisher} : generates sets of directions drawn from Fisher distributions with vertical true mean
%\item \href{http://pmagpy.github.io/PmagPy.html#fishrot}{fishrot} : generates sets of directions drawn from Fisher distributions with arbitrary true mean
%\item \href{http://pmagpy.github.io/PmagPy.html#gaussian}{gaussian} : generates data drawn from a normal distribution
%\item \href{http://pmagpy.github.io/PmagPy.html#gobing}{gobing} : calculates Bingham statistics from a set of directions
%\item \href{http://pmagpy.github.io/PmagPy.html#gofish}{gofish} : calculates Fisher statistics from a set of directions
%\item \href{http://pmagpy.github.io/PmagPy.html#gokent}{gokent} : calculates Kent statistics from a set of directions
%\item \href{http://pmagpy.github.io/PmagPy.html#goprinc}{goprinc} : calculates principal directions statistics
%\item \href{http://pmagpy.github.io/PmagPy.html#igrf}{igrf} : calculates geomagnetic field vectors for location, age given a field model (e.g., IGRF)
%\item \href{http://pmagpy.github.io/PmagPy.html#incfish}{incfish} : estimates the true mean inclination from inclination only data
%\item \href{http://pmagpy.github.io/PmagPy.html#pca}{pca} : calculates the best-fit line or plane for demagnetization data and associated statistics
%\item \href{http://pmagpy.github.io/PmagPy.html#pt_rot}{pt\_rot} : rotates point given finite rotation pole
%\item \href{http://pmagpy.github.io/PmagPy.html#scalc}{scalc} : calculates  VGP scatter
%\item \href{http://pmagpy.github.io/PmagPy.html#s_eigs}{s\_eigs} : takes a 6 element tensor and calculates eigen parameters (see eigs\_s)
%\item \href{http://pmagpy.github.io/PmagPy.html#s_geo}{s\_geo} : rotates 6 element tensors to geographic coordinates
%\item \href{http://pmagpy.github.io/PmagPy.html#s_hext}{s\_hext} : calculates Hext statistics from 6 element tensors
%\item \href{http://pmagpy.github.io/PmagPy.html#s_tilt}{s\_tilt} : rotates 6 element tensors to stratigraphic coordinates
%\item \href{http://pmagpy.github.io/PmagPy.html#squish}{squish}: flattens inclination data given flattening factor (see unsquish)
%\item \href{http://pmagpy.github.io/PmagPy.html#sundec}{sundec} : calulates direction to sun for location, date, time and sun azimuth
%\item \href{http://pmagpy.github.io/PmagPy.html#tk03}{tk03} : generates sets of directions consistent with the TK03 field model
%\item \href{http://pmagpy.github.io/PmagPy.html#uniform}{uniform} : generates sets of uniformly distributed directions
%\item \href{http://pmagpy.github.io/PmagPy.html#unsquish}{unsquish} : unsquishes flattened inclinations, given flattening factor (see squish)
%\item \href{http://pmagpy.github.io/PmagPy.html#vector_mean}{vector\_mean} : calculates vector mean for sets of vectors (declination, inclination, intensity)
%\item \href{http://pmagpy.github.io/PmagPy.html#vdm_b}{vdm\_b} : calculates intensity at given location from specified virtual dipole moment (see b\_vdm)
%\item \href{http://pmagpy.github.io/PmagPy.html#vgp_di}{vgp\_di} : calculates direction at given location from virtual geomagnetic pole (see di_vgp)
  %\item \href{http://pmagpy.github.io/PmagPy.html#watsons_f}{watsons\_f} : calculates Watson's F statistic for testing for common mean

  \item \href{https://pmagpy.github.io/PmagPy_calculations.html#aarm_magic}{aarm\_magic} : calculate AARM tensors
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#atrm_magic}{atrm\_magic} : calculate ATRM tensors
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#angle}{angle} : calculates the angle between two vectors
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#apwp}{apwp} : returns predicted paleolatitudes, directions and pole latitude/longitude from apparent polar wander paths of Besse and Courtillot (2002).
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#b_vdm}{b\_vdm} : converts B (in microT) and (magnetic) latitude to V(A)DM (see \href{https://pmagpy.github.io/PmagPy_calculations.html#vdm_b}{vdm\_b})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#bootams}{bootams} : calculates bootstrap statistics for tensor data
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#cart_dir}{cart\_dir} : converts cartesian coordinates (x,y,z) to declination, inclination, intensity (see \href{https://pmagpy.github.io/PmagPy_calculations.html#dir_cart}{dir\_cart})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#di_eq}{di\_eq} : maps declination, inclinatitions to X,Y for plotting in equal area projections
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#di_geo}{di\_geo} : rotates declination, inclination in specimen coordinates to geographic coordinates
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#di_rot}{di\_rot} : rotates directions to a  coordinate system with D,I as center
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#di_tilt}{di\_tilt} : rotates directions to stratigraphic coordinates
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#di_vgp}{di\_vgp} : converts direction to Virtual Geomagnetic Pole (see \href{https://pmagpy.github.io/PmagPy_calculations.html#vgp_di}{vgp\_di})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#dia_vgp}{dia\_vgp} : converts direction and $\\alpha_{95}$ to Virtual Geomagnetic Pole and dp,dm
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#dipole_pinc}{dipole\_pinc} : calculates inclination given latitude assuming geocentric axial dipole
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#dipole_plat}{dipole\_plat} : calculates latitude given inclination assuming geocentric axial dipole
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#dir_cart}{dir\_cart} : converts declination, inclination, intensity to cartesian coordinates (see \href{https://pmagpy.github.io/PmagPy_calculations.html#cart_dir}{cart\_dir})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#eigs_s}{eigs\_s} : converts eigenparameters to equivalent 6 element tensor (see \href{https://pmagpy.github.io/PmagPy_calculations.html#s_eigs}{s\_eigs})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#eq_di}{eq\_di} : takes X,Y from equal area projection (e.g., from digitized coordinates) and  converts to declination, inclination
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#fcalc}{fcalc} : returns the value from an F table, given the degrees of freedom.
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#fisher}{fisher} : generates sets of directions drawn from Fisher distributions with vertical true mean
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#fishrot}{fishrot} : generates sets of directions drawn from Fisher distributions with arbitrary true mean
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#flip}{flip} : flips a second mode (reverse directions) to their antipodes
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#gaussian}{gaussian} : generates data drawn from a normal distribution
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#gobing}{gobing} : calculates Bingham statistics from a set of directions
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#gofish}{gofish} : calculates Fisher statistics from a set of directions
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#gokent}{gokent} : calculates Kent statistics from a set of directions
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#goprinc}{goprinc} : calculates principal directions statistics
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#igrf}{igrf} : calculates geomagnetic field vectors for location, age given a field model (e.g., IGRF)
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#incfish}{incfish} : estimates the true mean inclination from inclination only data
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#pca}{pca} : calculates the best-fit line or plane for demagnetization data and associated statistics
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#pt_rot}{pt\_rot} : rotates point given finite rotation pole
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#scalc}{scalc} : calculates  VGP scatter
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#s_eigs}{s\_eigs} : takes a 6 element tensor and calculates eigen parameters (see \href{https://pmagpy.github.io/PmagPy_calculations.html#eigs_s}{eigs\_s})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#s_geo}{s\_geo} : rotates 6 element tensors to geographic coordinates
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#s_hext}{s\_hext} : calculates Hext statistics from 6 element tensors
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#s_tilt}{s\_tilt} : rotates 6 element tensors to stratigraphic coordinates
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#separate_directions}{separate\_directions} : separates a set of directions into two modes (normal and reverse)
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#squish}{squish} : flattens inclination data given flattening factor (see \href{https://pmagpy.github.io/PmagPy_calculations.html#unsquish}{unsquish})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#sundec}{sundec} : calulates direction to sun for location, date, time and sun azimuth
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#tk03}{tk03} : generates sets of directions consistent with the TK03 field model
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#uniform}{uniform} : generates sets of uniformly distributed directions
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#unsquish}{unsquish} : unsquishes flattened inclinations, given flattening factor (see \href{https://pmagpy.github.io/PmagPy_calculations.html#squish}{squish})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#vector_mean}{vector\_mean} : calculates vector mean for sets of vectors (declination, inclination, intensity)
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#vdm_b}{vdm\_b} : calculates intensity at given location from specified virtual dipole moment (see \href{https://pmagpy.github.io/PmagPy_calculations.html#b_vdm}{b\_vdm})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#vgp_di}{vgp\_di} : calculates direction at given location from virtual geomagnetic pole (see \href{https://pmagpy.github.io/PmagPy_calculations.html#di_vgp}{di\_vgp})
\item \href{https://pmagpy.github.io/PmagPy_calculations.html#watsons_f}{watsons\_f} : calculates Watson's F statistic for testing for common mean

  \end{itemize}

Plots:

\begin{itemize}

  %\item \href{http://pmagpy.github.io/PmagPy.html#ani_depthplot}{ani\_depthplot} : plots anisotropy data against depth in stratigraphic section (Xmas tree plots)
%\item \href{http://pmagpy.github.io/PmagPy.html#aniso_magic}{aniso\_magic} : makes plots of anisotropy data and bootstrapped confidences
%\item \href{http://pmagpy.github.io/PmagPy.html#biplot_magic}{biplot\_magic} : plots different columns against each other in MagIC formatted data files
%\item \href{http://pmagpy.github.io/PmagPy.html#chi_magic}{chi\_magic} : plots magnetic susceptibility data in MagIC format as function of field, frequency or temperature
%\item \href{http://pmagpy.github.io/PmagPy.html#common_mean}{common\_mean} : graphical approach to testing two sets of directions for common mean using bootstrap
%\item \href{http://pmagpy.github.io/PmagPy.html#core_depthplot}{core\_depthplot} : plots MagIC formatted data
%\item \href{http://pmagpy.github.io/PmagPy.html#curie}{curie} : makes plots of Curie Temperature data and provides estimates for Tc
%\item \href{http://pmagpy.github.io/PmagPy.html#dayplot}{dayplot\_magic} : makes Day et al. (1977) and other plots with hysteresis statistics
%\item \href{http://pmagpy.github.io/PmagPy.html#dmag_magic}{dmag\_magic} : plots remanence against demagnetization step for MagIC formatted files
%\item \href{http://pmagpy.github.io/PmagPy.html#eqarea}{eqarea} and \href{http://pmagpy.github.io/PmagPy.html#eqarea_magic}{eqarea\_magic} : makes equal area projections for directions
%\item \href{http://pmagpy.github.io/PmagPy.html#eqarea_ell}{eqarea\_ell} : makes equal area projections for directions with specified confidence ellipses
%\item \href{http://pmagpy.github.io/PmagPy.html#find_ei}{find\_ei} : finds the inclination unflattening factor that unsquishes directions to match TK03 distribution
%\item \href{http://pmagpy.github.io/PmagPy.html#fishqq}{fishqq}: makes a Quantile-Quantile plot for directions against uniform and exponential distributions
%\item \href{http://pmagpy.github.io/PmagPy.html#foldtest}{foldtest} and \href{http://pmagpy.github.io/PmagPy.html#foldtest_magic}{foldtest\_magic} : finds  tilt correction that maximizes concentration of directions, with bootstrap confidence bounds.
  %\item \href{http://pmagpy.github.io/PmagPy.html#forc_diagram}{forc\_diagram} : plots FORC diagrams for both conventional and irregular FORCs

%\item \href{http://pmagpy.github.io/PmagPy.html#hysteresis_magic}{hysteresis\_magic} : makes plots of hysteresis data (not FORCs).
%\item \href{http://pmagpy.github.io/PmagPy.html#irm_magic}{irm\_magic} : plots IRM acquistion data
%\item \href{http://pmagpy.github.io/PmagPy.html#irm_unmix}{irm\_unmix} : unmixes IRM acquisition data into dominant components
%\item \href{http://pmagpy.github.io/PmagPy.html#lnp_magic}{lnp\_magic} : plots lines and planes for site level data and calculates best fit mean and alpha\_95
%\item \href{http://pmagpy.github.io/PmagPy.html#lowes}{lowes} : makes a plot of the Lowe's spectrum for a geomagnetic field model
%\item \href{http://pmagpy.github.io/PmagPy.html#lowrie}{lowrie} and \href{http://pmagpy.github.io/PmagPy.html#lowrie_magic}{lowrie\_magic} : makes plots of Lowrie's (1990) 3D-IRM demagnetization experiments
%\item \href{http://pmagpy.github.io/PmagPy.html#plot_cdf}{plot\_cdf} and \href{http://pmagpy.github.io/PmagPy.html#plot_2cdfs}{plot\_2cdfs} : makes a cumulative distribution plot of data
%\item \href{http://pmagpy.github.io/PmagPy.html#plotdi_a}{plotdi\_a} : makes equal are plots of directions and their alpha95s
%\item \href{http://pmagpy.github.io/PmagPy.html#plot_geomagia}{plot\_geomagia} : makes plots from files downloaded from the  geomagia website
%\item \href{http://pmagpy.github.io/PmagPy.html#plot_magic_keys}{plot\_magic\_keys} : plots data from MagIC formatted data files
%\item \href{http://pmagpy.github.io/PmagPy.html#qqplot}{qqplot} : makes a Quantile-Quantile plot for data against a normal distribution
%\item \href{http://pmagpy.github.io/PmagPy.html#qqunf}{qqunf} : makes a Quantile-Quantile plot for data against a uniform distribution
%\item \href{http://pmagpy.github.io/PmagPy.html#revtest}{revtest} and \href{http://pmagpy.github.io/PmagPy.html#revtest_magic}{revtest\_magic} : performs a bootstrap reversals test
%\item \href{http://pmagpy.github.io/PmagPy.html#thellier_magic}{thellier\_magic} : makes plots of thellier-thellier data.
%\item \href{http://pmagpy.github.io/PmagPy.html#watsons_v}{watsons\_v} : makes a graph for Watson's V test for common mean
  %\item \href{http://pmagpy.github.io/PmagPy.html#zeq}{zeq} and \href{http://pmagpy.github.io/PmagPy.html#zeq_magic}{zeq\_magic} : makes quicky zijderveld plots for measurement data

  \item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#ani_depthplot}{ani\_depthplot} : plots anisotropy data against depth in stratigraphic section (Xmas tree plots)
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#aniso_magic}{aniso\_magic} : makes plots of anisotropy data and bootstrapped confidences
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#biplot_magic}{biplot\_magic} : plots different columns against each other in MagIC formatted data files
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#chi_magic}{chi\_magic} : plots magnetic susceptibility data in MagIC format as function of field, frequency or temperature
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#common_mean}{common\_mean} : graphical approach to testing two sets of directions for common mean using bootstrap
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#core_depthplot}{core\_depthplot} : plots MagIC formatted data
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#curie}{curie} : makes plots of Curie Temperature data and provides estimates for Tc
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#dayplot_magic}{dayplot\_magic} : makes Day et al. (1977) and other plots with hysteresis statistics
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#dmag_magic}{dmag\_magic} : plots remanence against demagnetization step for MagIC formatted files
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#eqarea}{eqarea} and \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#eqarea_magic}{eqarea\_magic} : makes equal area projections for directions
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#eqarea_ell}{eqarea\_ell} : makes equal area projections for directions with specified confidence ellipses
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#find_ei}{find\_ei} : finds the inclination unflattening factor that unsquishes directions to match TK03 distribution
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#fishqq}{fishqq} : makes a Quantile-Quantile plot for directions against uniform and exponential distributions
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#foldtest}{foldtest} and \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#foldtest_magic}{foldtest\_magic} : finds  tilt correction that maximizes concentration of directions, with bootstrap confidence bounds.
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#forc_diagram}{forc\_diagram} : plots FORC diagrams for both conventional and irregular FORCs
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#hysteresis_magic}{hysteresis\_magic} : makes plots of hysteresis data (not FORCs).
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#irm_unmix}{irm\_unmix} : analyzes IRM acquisition data in terms of coercivity distributions
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#irmaq_magic}{irmaq\_magic} : plots IRM acquistion data
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#lnp_magic}{lnp\_magic} : plots lines and planes for site level data and calculates best fit mean and alpha_95
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#lowes}{lowes} : makes a plot of the Lowe's spectrum for a geomagnetic field model
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#lowrie}{lowrie} and \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#lowrie}{lowrie\_magic} : makes plots of Lowrie's (1990) 3D-IRM demagnetization experiments
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#plot_cdf}{plot\_cdf} and \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#plot_2cdfs}{plot\_2cdfs} : makes a cumulative distribution plot of data
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#plotdi_a}{plotdi\_a} : makes equal are plots of directions and their $\\alpha_{95}$s
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#plot_geomagia}{plot\_geomagia} : makes plots from files downloaded from the  geomagia website
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#plot_magic_keys}{plot\_magic\_keys} : plots data from MagIC formatted data files
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#plot_ts}{plot\_ts} : makes a plot of the desired Geomagnetic Reversal time scale
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#qqplot}{qqplot} : makes a Quantile-Quantile plot for data against a normal distribution
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#qqunf}{qqunf} : makes a Quantile-Quantile plot for data against a uniform distribution
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#quick_hyst}{quick\_hyst} : makes hysteresis plots
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#revtest}{revtest} and \href {https://pmagpy.github.io/PmagPy_plots_analysis.html#revtest_magic}{revtest\_magic} : performs a bootstrap reversals test
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#thellier_magic}{thellier\_magic} : makes plots of thellier-thellier data.
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#watsons_v}{watsons\_v} : makes a graph for Watson's V test for common mean
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#zeq}{zeq} and \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#zeq_magic}{zeq\_magic} : makes quicky zijderveld plots for measurement data

\end{itemize}

Maps:

\begin{itemize}

  %\item \href{http://pmagpy.github.io/PmagPy.html#cont_rot}{cont\_rot} : makes plots of continents after rotation to specified coordinate system
%\item \href{http://pmagpy.github.io/PmagPy.html#plot_magmap}{plot\_magmap} : makes a color contour plot of geomagnetic field models
%\item \href{http://pmagpy.github.io/PmagPy.html#plot_map_pts}{plot\_map\_pts} : plots points on maps
%\item \href{http://pmagpy.github.io/PmagPy.html#polemap_magic}{polemap\_magic} : reads in MagIC formatted file with paleomagnetic poles and plots them
  %\item \href{http://pmagpy.github.io/PmagPy.html#vgpmap_magic}{vgpmap\_magic} : reads in MagIC formatted file with virtual geomagnetic poles and plots them

\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#cont_rot}{cont\_rot} : makes plots of continents after rotation to specified coordinate system
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#plot_mag_map}{plot\_mag\_map} : makes a color contour plot of geomagnetic field models
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#plot_map_pts}{plot\_map\_pts} : plots points on maps
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#polemap_magic}{polemap\_magic} : reads in MagIC formatted file with paleomagnetic poles and plots them
\item \href{https://pmagpy.github.io/PmagPy_plots_analysis.html#vgpmap_magic}{vgpmap\_magic} : reads in MagIC formatted file with virtual geomagnetic poles and plots them

\end{itemize}

Working with MagIC:
\begin{itemize}
%\item \href{http://pmagpy.github.io/PmagPy.html#magic_read}{magic\_read} : reading in MagIC formatted files
%\item \href{http://pmagpy.github.io/PmagPy.html#magic_write}{magic\_write} : outputing MagIC formatted files
%\item \href{http://pmagpy.github.io/PmagPy.html#combine_magic}{combine\_magic} : combines two MagIC formatted files of same type
%\item \href{http://pmagpy.github.io/PmagPy.html#convert_ages}{convert\_ages} : convert ages in downloaded MagIC file to Ma
%\item \href{http://pmagpy.github.io/PmagPy.html#grab_magic_key}{grab\_magic\_key} : prints out a single column from a MagIC format file
%\item \href{http://pmagpy.github.io/PmagPy.html#magic_select}{magic\_select} : selects data from MagIC format file given conditions (e.g., method\_codes contain string)
  %\item \href{http://pmagpy.github.io/PmagPy.html#Contributions}{Contributions} work with data model 3.0 MagIC contributions
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#reading MagIC files}{reading MagIC files (magic\_read)} : reading in MagIC formatted files
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#writing MagIC files}{writing MagIC files (magic\_write)} : outputing MagIC formatted files
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#combine_magic}{combine\_magic} : combines two MagIC formatted files of same type
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#convert_ages}{convert\_ages} : convert ages in downloaded MagIC file to Ma
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#grab_magic_key}{grab\_magic\_key} : prints out a single column from a MagIC format file
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#magic_select}{magic\_select} : selects data from MagIC format file given conditions (e.g., method_codes contain string)
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#sites_extract}{sites\_extract} : makes excel or latex files from sites.txt for publications
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#criteria_extract}{criteria\_extract} : makes excel or latex files from criteria.txt for publications
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#specimens_extract}{specimens\_extract} : makes excel or latex files from specimens.txt for publications

\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#Contributions}{contributions} : work with data model 3.0 MagIC contributions
  \begin{itemize}

%\item \href{http://pmagpy.github.io/PmagPy.html#download_magic}{download\_magic} : unpacks a contribution text file downloaded from the MagIC website
%\item \href{http://pmagpy.github.io/PmagPy.html#upload_magic}{upload\_magic} : prepares a directory with a MagIC contribution for uploading to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#cb.add_sites_to_meas_table}{cb.add\_sites\_to\_meas\_table} : completes a measurements data frame with the information required for plotting by site.
    %\item \href{http://pmagpy.github.io/PmagPy.html#cb.get_intensity_col}{cb.get\_intensity\_col} : finds the first non-zero type of intensity data in a measurements dataframe.

    \item \href{https://pmagpy.github.io/PmagPy_MagIC.html#download_magic}{download\_magic} : unpacks a contribution text file downloaded from the MagIC website
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#upload_magic}{upload\_magic} : prepares a directory with a MagIC contribution for uploading to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#cb.add_sites_to_meas_table}{cb.add\_sites\_to\_meas\_table} : completes a measurements data frame with the information required for plotting by site.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#cb.get_intensity_col}{cb.get\_intensity\_col} : finds the first non-zero type of intensity data in a measurements dataframe.
  \end{itemize}
  %\item \href{http://pmagpy.github.io/PmagPy.html#convert_2_magic}{convert\_2\_magic} : convert many laboratory measurement formats to the MagIC data model 3 format
  \item \href{https://pmagpy.github.io/PmagPy_MagIC.html#Conversion-Scripts}{conversion scripts} : convert many laboratory measurement formats to the MagIC data model 3 format
  \begin{itemize}
%\item \href{http://pmagpy.github.io/PmagPy.html#_2g_asc_magic}{\_2g\_asc\_magic} : convert the 2G ascii file to MagIC - but no example yet.
%\item \href{http://pmagpy.github.io/PmagPy.html#_2g_bin_magic}{\_2g\_bin\_magic} : convert 2G binary format to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#agm_magic}{agm\_magic} : convert Princeton Measurements alternating gradient force magnetization (AGM) output files to the MagIC format.
%\item \href{http://pmagpy.github.io/PmagPy.html#bgc_magic}{bgc\_magic} : convert the Berkeley Geochronology lab format to MagIC.
%\item \href{http://pmagpy.github.io/PmagPy.html#cit_magic}{cit\_magic} : convert the Cal Tech file format.
%\item \href{http://pmagpy.github.io/PmagPy.html#generic_magic}{generic\_magic} : convert the generic file format to MagIC.
%\item \href{http://pmagpy.github.io/PmagPy.html#huji_magic}{huji\_magic} : convert Hebrew University, Jerusalem, Israel file format to MagIC.
%\item \href{http://pmagpy.github.io/PmagPy.html#huji_sample_magic}{huji\_sample\_magic} : convert the HUJI sample file to a MagIC format.
%\item \href{http://pmagpy.github.io/PmagPy.html#jr6_jr6}{jr6\_jr6\_magic} : convert the AGICO JR6 spinner .jr6 output to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#jr6_txt_magic}{jr6\_txt\_magic} : convert the AGICO JR6 txt format to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#k15_magic}{k15\_magic} : convert  15 measurement anisotropy of magnetic susceptibility file format to MagIC.
%\item \href{http://pmagpy.github.io/PmagPy.html#ldeo_magic}{ldeo\_magic} : convert Lamont-Doherty file format to MagIC.
%\item \href{http://pmagpy.github.io/PmagPy.html#livdb_magic}{livdb\_magic} : convert Liverpool file format to MagIC.
%\item \href{http://pmagpy.github.io/PmagPy.html#mst_magic}{mst\_magic} : convert Curie Temperature experimental data to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#sio_magic}{sio\_magic} : convert the Scripps Institution of Oceanography data format to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#sufar4_magic}{sufar4\_magic} : convert the AGICO SUFAR program (ver.1.2.) ascii file format to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#s_magic}{s\_magic} : convert the 6 tensor element format (.s) to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#kly4s_magic}{kly4s\_magic} : convert the AMSSpin format of Gee et al. 2008 to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#tdt_magic}{tdt\_magic} : convert the Thellier Tool format to MagIC 3.0
%\item \href{http://pmagpy.github.io/PmagPy.html#utrecht_magic}{utrecht\_magic} : convert the Fort Hoofddijk, Utrecht University Robot file format to MagIC
%\item \href{http://pmagpy.github.io/PmagPy.html#orientation_magic}{orientation\_magic} : convert an "orient.txt" formatted file with field notebook information into MagIC formatted files
    %\item \href{http://pmagpy.github.io/PmagPy.html#azdip_magic}{azdip\_magic} : convert an "azdip" formatted file to a samples.txt file format

\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#_2g_asc_magic}{\_2g\_asc\_magic} : converts 2G ascii files to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#_2g_bin_magic}{\_2g\_bin\_magic} : converts 2G binary files to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#agm_magic}{agm\_magic} : converts Princeton Measurements alternating gradient force magnetization (AGM) files to MagIC.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#bgc_magic}{bgc\_magic} : convert Berkeley Geochronology Center files to MagIC.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#cit_magic}{cit\_magic} : convert Cal Tech format files to MagIC.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#generic_magic}{generic\_magic} : converts generic files to MagIC.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#huji_magic}{huji\_magic} : converts Hebrew University, Jerusalem, Israel files to MagIC.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#huji_sample_magic}{huji\_sample\_magic} : converts HUJI files to a MagIC format.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#jr6_jr6_magic}{jr6\_jr6\_magic} : converts the AGICO JR6 spinner .jr6 files to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#jr6_txt_magic}{jr6\_txt\_magic} : converts the AGICO JR6 .txt files to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#k15_magic}{k15\_magic} : converts 15 measurement anisotropy of magnetic susceptibility files to MagIC.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#kly4s_magic}{kly4s\_magic} : converts SIO KLY4S formatted files to MagIC.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#ldeo_magic}{ldeo\_magic} : converts Lamont-Doherty files to MagIC.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#livdb_magic}{livdb\_magic} : converts Liverpool files to MagIC.
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#mst_magic}{mst\_magic} : converts Curie Temperature experimental data to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#sio_magic}{sio\_magic} : converts Scripps Institution of Oceanography data files to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#sufar4_magic}{sufar4\_magic} : converts AGICO SUFAR program (ver.1.2.) ascii files to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#tdt_magic}{tdt\_magic} : converts Thellier Tool files to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#utrecht_magic}{utrecht\_magic} : converts Fort Hoofddijk, Utrecht University Robot files to MagIC
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#orientation_magic}{orientation\_magic} : converts an ``orient.txt'' formatted file with field notebook information into MagIC formatted files
\item \href{https://pmagpy.github.io/PmagPy_MagIC.html#azdip_magic}{azdip\_magic} : converts an ``azdip'' formatted file to a samples.txt file format

  \end{itemize}

\end{itemize}

Other handy scripts:

\begin{itemize}

  %\item \href{http://pmagpy.github.io/PmagPy.html#chartmaker}{chartmaker} : script for making chart to guide IZZI lab experiment
  \item \href{https://pmagpy.github.io/PmagPy_MagIC.html#chartmaker}{chartmaker} : script for making chart to guide IZZI lab experim

  \end{itemize}


\section{Using PmagPy}

Much more information is available on each {\bf PmagPy} program.  To learn how to use {\bf PmagPy} in a Python environment (i.e., a Juypyter notebook, the Python interpreter, or your own Python script), you have two options.

You can run an interactive \href{https://mybinder.org/v2/gh/PmagPy/PmagPy-notebooks/master?filepath=PmagPy.ipynb}{{\bf PmagPy} demo} here.  Please be patient -- it will take a few minutes to initialize.

You can view a static \href{https://pmagpy.github.io/PmagPy_introduction.html}{{\bf PmagPy} page} here.  The data files used in the examples are located in the {\it data\_files} directory bundled with the {\bf PmagPy} software distribution.  If you need help finding the data\_files, see the \href{#getting_python}{install instructions}.

Both the interactive demo and the static page contain a comprehensive introduction to {\bf PmagPy}.

You can also see the source code online at:

 \customlink{github}

 \url{https://github.com/PmagPy/PmagPy}



\section{Using PmagPy on the command line}

{\bf PmagPy}  can also be used on the \href{#command_line}{command line}.
% The python scripts must be placed in a directory that is in your ``path''.  To see if this has been properly done, type {\bf dir\_cart.py -h} on the command line and you should get a help message.  If you get a ``command not found'' message, you need to fix your path; check the ``installing python'' page on the software website.   Another possible cause for failure is that somehow, the python scripts are no longer executable.  To fix this, change directories into the directory with the scripts, and type the command:  chmod a+x *.py

Here is a brief introduction to how the {\bf PmagPy} command-line programs work.  All {\bf PmagPy} programs print a help message out if you type: ``{\bf program\_name.py -h}'' on the command line.  Many have an ``interactive'' option triggered by typing {\bf program\_name.py -i}.  Many also allow reading from \href{#standard_IO }{standard input and output}.   The help message will explain how each particular program functions.  There are some common features for the command line options:


\begin{itemize}
\item Switches are from one to three characters long, preceded by a '-'.
\item The switch '-h' always prints the help message and '-i' allows interactive entry of options.
\item  Options for command line switches immediately follow the switch.  For example:  -f INPUT -F OUTPUT will set the input file to INPUT and the output to OUTPUT.
\item  The switch for input  files all start with -f and -F for output files.
\item -spc -sam -sit -syn  -loc are switches relating to specimens, samples, sites, synthetics and locations respectively.
\item Capitalized switches suppress an option (e.g., -A means do not average, while -a means DO average).
\item -crd [s,g,t] sets the coordinate system
\item -fmt [svg,png,jpg] the default image format.
\item -sav  saves the plots silently and quits the program
\end{itemize}
\newcommand{\stt}{\small\tt}
\newcount\exnum
\outer\def\example{\medbreak\advance\exnum by 1
  \noindent{$\item$ \bf Example \the\exnum\enspace} \noindent}


Depending on your operating system, you  may need to use a different command to invoke a command line program.  See \href{#which_command}{this section} for details.

You can see examples for each program on the \href{http://pmagpy.github.io/PmagPy-cli.html}{{\bf PmagPy-cli} page}. The data files used in the examples are located in the {\it data\_files} directory bundled with the {\bf PmagPy} software distribution.  If you need help finding the data\_files, see the \href{#getting_python}{install instructions}.

You can also see the source code online at:

 \customlink{github}

 \url{https://github.com/PmagPy/PmagPy}



\customlink{pmag_gui.py}
\chapter{Pmag GUI Tutorial}
\label{chap:Pmag GUI}

{\bf Pmag GUI} is a Graphical User Interface (GUI) written by Lori Jonestrask and Ron Shaar  that provides a quick path to the main {\bf PmagPy} programs. The work flow is illustrated schematically here:

\includegraphics[width=15cm]{EPSFiles/FigQkMagicFlow.eps}

Note: {\bf Pmag GUI} is available for use with both 3.0 and 2.5 data.  All new contributions should be built up using 3.0, but 2.5 may be used for legacy data sets and then later upgraded using the \href{https://www.earthref.org/MagIC/upgrade}{MagIC site}.  You may specify which data model you want to use on the command-line using the switch ``-DM'', or in the window that pops up when you first open {\bf Pmag GUI}.

\includegraphics[width=6in]{EPSFiles/PmagGUI_choose_data_model.eps}

\begin{enumerate}
\item Make sure you have followed all of the steps in the \href{#quick_start}{Installing PmagPy} section.

\customlink{Project_Directory}

\item Open your command prompt and start {\bf Pmag GUI} with the appropriate command (pmag\_gui.py, pmag\_gui\_anaconda, or pmag\_gui).  If you are confused about which command to use, see \href{#which_command}{this section} for details.

\item  When you start {\bf Pmag GUI}, the first step is to change directories into a  `Project Directory'. For each study, create a directory with a name that relates to that study. Here we will call it {\it ThisProject}.  This is where you will collect and process all the rock and paleomagnetic data for a given study, usually a publication. The project directory name should have NO SPACES and be placed on the hard drive in a place that has NO spaces in the path. Under certain Windows versions, this means you should not use your home directory, but create a directory called for example:\begin{verbatim}
  D:\MyPmagProjects\end{verbatim} and put {\it ThisProject} there.
%
%Inside the  {\it ThisProject} directory, create two additional directories: {\it MyFiles} and {\it MagIC}. All the files that you want to convert to the MagIC format should be placed in {\it MyFiles}.  The {\it Project Directory} that {\bf Pmag GUI} seeks is that {\it MagIC} directory.
%
%Your Directory tree might look like this now:
%
%\includegraphics[width=15cm]{EPSFiles/ProjectDirectory.eps}


\item \textbf{copy example files:}  Use \textbf{move\_data\_files.py} to move the  datafiles to an accessible location.  Use: \begin{verbatim}

  move_data_files.py -h\end{verbatim} on the command line for help).  In the {\it PmagPy-data/data\_files } folder you will find a subfolder named {\it Pmag\_GUI}. Copy the contents of the  \href{#Project_Directory}{\it ThisProject} directory  into  your  own \href{#Project_Directory}{Project Directory} folder.
 \item Start Pmag GUI either by typing {\bf pmag\_gui.py} on your \href{#command_line}{command line}, or (if you have the \href{#standalone}{standalone}), by double-clicking the Pmag GUI icon on your Desktop.
 \item If necessary, change directories by clicking  on the ``change directory'' button and select your own {\it ThisProject} directory.
 \end{enumerate}

 \customlink{convert2magic}

\section{Converting magnetometer files to MagIC format}
\begin{itemize}
\item {\bf Pmag GUI} allows for converting many different laboratory formats.  For more information, see the section on \href{#magnetometer_files}{Supported Rock Magnetometer files}.   In this example, we will use a `generic' file format.
%rshaar% In the {\it MyFiles} folder there are  files containing AF, Thermal, and Thellier measurement data of samples from location Snake River (lava flow site). All samples are from site sr01. The measurement data are arranged in the generic format.
An example of the generic file format is shown here:

\includegraphics[width=30cm]{EPSFiles/FigGenericFormat.eps}

To learn what all the column headers mean look at the documentation for \href{#generic_magic.py}{generic\_magic.py}.

%\item Locate the {\it MyFiles} folder in  the {\it Datafiles} subdirectory named {\it Pmag GUI} and copy the contents to your own {\it MyFiles} directory.
%
%\includegraphics[width=15cm]{EPSFiles/FigMyFiles.eps}

%\item Run the program: Open up a terminal window (Mac) or command prompt (Windows) and type pmag_gui.py on the command line. In the Pmag GUI main panel press the Õchange dirÕ button. Select the MagIC directory in ThisProject when prompted.

\item In your  \href{#Project_Directory}{\it ThisProject} directory  there are three files with AF, Thermal, and Thellier measurement data of specimens from site sr01 (a lava flow site) of \cite{tauxe04b}.  There is also a file with sample orientation, location and other metadata typical for a paleomagnetic study.
\item Press the [Convert magnetometer files to MagIC format] button. If no menu pops up or the window is blank, click on the Python icon  (the little space ship, pencil and paper, or feather) on your dock. You should see a dialog window will appear with different file formats:

\includegraphics[width=30cm]{EPSFiles/FigChooseFile.eps}

\item  Click on  `generic format'  and press the  [import file] button.  A new dialog box will appear. For more details click on the [help] button.
\item  In the dialog box, click on the [Add] button and choose one of the measurements files.
\item  Optional: Insert your EarthRef user name.
\item Choose your experiment type from the dropdown list.

\item Choose specimen-sample naming convention.  In this example, specimen sr01a1 belongs to sample sr01a so the specimen-sample naming convention is  `no. of terminal characters ' and the delimiter/number field is `1' ).
\item Choose sample-site naming convention.  In this example, sample sr01a belongs to site sr01 so the sample-site naming convention is  `no. of terminal characters' with a delimiter/number of  `1'.
\item  Fill in the \href{#MagICDatabase}{EarthRef Location Name}  for this project .  For this project, it is ``Snake River''.
\customlink{location_name}

\item Note:  a location is a stratigraphic section,  a sampling region,  an drill core, and so on.  MagIC doesn't really care what your location name is, but use the same location name every time you are asked for it, because it really ties your dataset together and is required within the data model.

Your dialog boxes should look like this for the AF and thermal data:

\includegraphics[width=30cm]{EPSFiles/FigConvertGenericA.eps}

and like this for the  paleointensity data.  For paleointensity data, you must also supply the lab field in micro tesla (40) and orientation relative to sample's X direction:  0 -90.

\includegraphics[width=30cm]{EPSFiles/FigConvertGenericB.eps}

\item Press OK to create a new MagIC measurement file, which is saved in your \href{#Project_Directory}{\it ThisProject} directory.


\customlink{Combine}

\item After converting all files to MagIC format, press the [Next Step] button in the `convert magnetometer files' dialog box. All files with the .magic suffix will be added to the list.  [You can edit the list by deleting unwanted files or adding additional MagIC formatted files.]   You should see a list of the three magic files:

\includegraphics[width=30cm]{EPSFiles/FigCombineMagic.eps}

\item Click the OK button. The three files will be combined to a single file,  named {\it measurements.txt} and also stored  in your \href{#Project_Directory}{\it ThisProject} directory.

\item In the next dialog, you will combine specimen, sample, site, and location files.
\end{itemize}

\customlink{orient}

\section{Optional: Calculate geographic / tilt-corrected direction}
\begin{itemize}
\item {\bf Pmag GUI} provides an optional tool for calculating geographic and tilt-corrected directions if those directions were not part of the original data files. To use this tool click on the button labeled `calculate geographic/tilt-corrected directions'.

\item When you open this window, an empty template of a file named demag\_orient.txt was created in your project directory. This file is displayed in a Python window. You can fill in  this file manually using the GUI window or \href{#field_info}{with with a spreadsheet program}. The template is pre-filled with sample names derived from your measurement files, using the naming rules that you chose.
\item To fill in the orientation information, click the button $\rightarrow$ [Import Orientation File] and  choose the file SrExample\_orient.txt from {\it MyFiles} folder.
\item Click the button $\rightarrow$ [Save orientation file].
\item Click the button $\rightarrow$ [Calculate sample orientations].
\item Fill in the [set orientation convention] dialog box like this:

\includegraphics[width=25cm]{EPSFiles/FigDemagOrient.eps}

\begin{itemize}
\item Orientation convention :Pomeroy.
\item Declination correction: Use the IGRF.
\item  Orientation priority: \#1.
\item Put in the number of hours to SUBTRACT from the local time to get to Greenwich Mean Time: -6. [Local time was 6 hours behind GMT for this example.]
\item press the OK button.
\end{itemize}
\item In the [additional required information] dialog window add the additional information:
\end{itemize}

\includegraphics[width=15cm]{EPSFiles/FigOrientMagicCodes.eps}

\section{Filling in metadata}

Filling in metadata is a critical part of building a MagIC Project Directory. The data relevant to this example are arranged in five tables: specimens, samples, sites, locations, ages. To complete the data, click the button, and follow the directions in the help window in order:

\begin{itemize}
\item Step 0: Choose the appropriate headers for each of your tables.  Required headers (or headers already present in your tables) show up in the top box, optional headers in the bottom.  In our example, you won't need to add any additional headers.  Once you have added all needed headers, click the OK button to proceed to the next step.

 \includegraphics[width=30cm]{EPSFiles/FigErMagicStep0.eps}

 \item The next steps contain editable grids.  For many columns, you can edit using drop-down menus that provide \href{http://earthref.org/MAGIC/shortlists.htm}{controlled vocabularies}.  For others, you must manually enter data into the cell.  A single left click will bring up a drop-down menu; a double-left click will call up the cell editor.  With both types of data entry, it is possible to select a single value for the entire column. Simply click on the column label.  If that column has a drop-down menu, you can then click on any cell in the column, the appropriate menu will pop up, and the value you select will propagate throughout the column.  Edits in that column will continue to be global until you select another column to edit or you de-select the column by clicking on the column label again.  If you select a column that does not have a drop-down menu, a text entry dialog will pop up, and the value you provide will be applied to the column.

 \item Step 1: Update the specimens table.  You may not rename specimens, but you may reassign them to a different sample.  It is also possible to add additional samples, using the 'Add new sample' button.  Note that type, lithology, and class columns need not be filled in here.  They will propagate down automatically when you select values at the sample or site level for type, lithology, and class.  In this example, you can just click [Save and continue].

 \includegraphics[width=25cm] {EPSFiles/FigErMagicStep1.eps}

\item Step 2:  Update the samples table.  You may rename samples, or you can reassign them to a different site.  You can also add additional sites using the ``Add a new site`` button.  In this example, you can just click [Save and continue].

 \includegraphics[width=20cm] {EPSFiles/FigErMagicStep2.eps}

\item Step 3: Update the sites table.  You may rename sites, or you can reassign them to a different location.  You can add additional locations using the ``Add a new location'' button.  You must choose a legal entry from the \href{http://earthref.org/MAGIC/shortlists.htm}{controlled vocabularies} for the following headers: ``class'', ``lithology'', ``type''. You may combine more than one controlled vocabulary by making them a colon delimited list.  If you select a value in these categories: class, lithology, type, longitude, or latitude, the values will propagate to the samples table.  In this example,  geologic_classes=Extrusive:Igneous; lithologies=Basaltic Lava; geologic_types=Lava Flow.  You should also add age data: age=2.3, age_unit=Ma.

\includegraphics[width=32cm] {EPSFiles/FigErMagicStep3.eps}


\item Step 4: Update the locations table.  If you have provided site latitudes and longitudes, the columns for beginning and ending latitudes and longitudes should be filled in already. Likewise, ``age_high'', ``age_low'', and ``age_unit'' will be filled with data from the sites table.  You must choose a legal entry from the \href{http://earthref.org/MAGIC/shortlists.htm}{controlled vocabularies} for the  ``location\_type''. In this example: location\_type = outcrop.

\includegraphics[width=32cm] {EPSFiles/FigErMagicStep4.eps}

\item Step 5: Add ages data.  For this tutorial, you can skip this step (just press [Save and continue]).

\end{itemize}

\customlink{DemagGUI}

\section{Demag GUI quick start}
\label{sect:demag_gui}

Next, click the [Demag GUI] button.  This is the main panel of the demag GUI:

\includegraphics[width=30cm]{EPSFiles/demag_gui.eps}

Use of the Demag GUI is described in more detail in the \href{#demag_gui.py}{Demag GUI} section below. Here are a few instructions that can be used as a quick start for using Demag GUI. {\bf Note}: If at any point you require help with a particular aspect of Demag GUI clicking on [Help] $\rightarrow$ [Usage and Tips] (hotkey: ctrl-h) then clicking on the item you wish to know more about will provide a pop-up box with information for most all aspects of the GUI and Interpretation Editor, see \hyperref[add-help]{additional help} for details.  (For Mac users, all hotkeys use the Command button instead of Ctrl.)

Before you start your analysis, you can choose your coordinate system.  From the `coordinate system' drop-down menu you can choose the coordinate system in which you wish to view the data (e.g.  `geographic'). The coordinate system and the orientation of the projection can be switched throughout your analysis which updates the view of the data within the Zijderveld vector component plot and the equal area directional projections.

To analyze the data in the example, follow these steps for each specimen:
\begin{itemize}
\item Click `add a fit' (hotkey: ctrl-n) and choose the temperature/AF bounds for the fit by double clicking on the measurement lines, by double clicking on the measurement points in the Zijderveld plot, or by choosing from the `bounds' dropdown menu.
\item Click the `next' button to analyze the next specimen (hotkey: ctrl-right).
\item Note: each fit will be saved in memory when you click `next' or `previous'.  To disable this behavior, de-select auto-save.
\end{itemize}

To calculate  Fisher mean for the site: choose from the `mean options' drop-down menus.  First select: component=All, then select: mean=Fisher.

All of the fits can be viewed and modified using the Interpretation Editor which can be selected from the Tools menu in the top menubar. (hotkey: ctrl-e)

To permanently save all of the specimen interpretations, choose from the menubar [File] $\rightarrow$ [Save MagIC  tables]. This saves all the interpretations in specimen/sample/site tables in your \href{#Project_Directory}{\it ThisProject} directory. Fits that are saved this way will be loaded into demag\_gui the next time it is launched.  Click through the dialog boxes and fill out choices for generating MagIC results.

If you are partway through your analysis, you may want to save your place without outputting to MagIC tables.  To save temporary analysis data use [File] $\rightarrow$ [Save interpretations to a redo file]. This saves all interpretation data to a redo file which will not load immediately when the GUI starts, but preserves aesthetic aspects of interpretations such as color as well as the specimen you were on when you saved to keep your place in analysis and allows rebooting of session without full export of MagIC tables.

Close the Demag GUI.


\customlink{ThellierGUI}

\section{Thellier GUI quick start}
Next, click the [Thellier GUI] button.  This is the main panel of the thellier GUI:

This image shows the main panel of \href{#ThellierGUI}{Thellier GUI}:

\includegraphics[width=30cm]{EPSFiles/FigThellierGui.eps}

Use of the Thellier GUI is described in more detail in the \href{#thellier_GUI.py}{Thellier GUI} section below and in this PDF document: \href{https://github.com/PmagPy/PmagPy-Cookbook/blob/gh-pages/thellier_GUI_full_manual.pdf}{Thellier GUI manual}. Here are a few instructions that can be used as a quick start for using Thellier GUI.

You can customize which selection criteria you need  under Preferences $=>$ Specimen paleointensity statistics (from SPD list).  This uses the \cite{paterson14} definitions of paleointensity statistices.
Next, select bounds for the statistics under [Analysis] $=>$[Acceptance criteria] $=>$ [Change acceptance criteria].

The default of the program is to calculate sample means. To change it to site level mean, choose from the menubar: [Analysis] $\rightarrow$ [Acceptance criteria] $\rightarrow$  [Change acceptance criteria]. Find the `average by sample/site' dropdown menu in the third row and change it to [site]. Click OK. The site mean will appear in the sample/site results box (top right).

Then, to analyze the data, follow these steps for each specimen:
 \begin{itemize}
 \item Choose temperature bounds from the temperatures dropdown menus.
 \item  Click the ‘next’ button to analyze the next specimen.
   \end{itemize}
Next, you will save these interpretations to a file.  To do so, choose from the menubar [File] $\rightarrow$ [Save MagIC pmag tables]. This save all the interpretations in the specimens.txt file in your MagIC Project Directory.
Close the Thellier GUI.


\customlink{magic_upload}

\section{Upload to the database }

To create a MagIC-format file for upload, you first click on the green {\it Create MagIC txt file for upload} button on the main page of {\bf Pmag GUI}. A file will be created in your \href{#Project_Directory}{\it ThisProject} directory.  Now, go to the  \href{http://earthref.org/MAGIC/}{MagIC  interface}.      Click on the `Upload Tool' button and upload your file by  draging and droping the {\it upload}   file onto the  `Drop and drop files here to upload' window.
Congratulations. Your data are now in the database under a Private Contribution.  But, they are not yet activated and cannot be until they are at least accepted for publication.  After you have a suitable reference, you can Activate your contribution.  Once you activate an uploaded dataset (only for published papers), it will be publicly available.

\customlink{magic_download}

\section{Downloading data from {\bf MagIC}}

Data can be downloaded from the {\bf MagIC} database and examined with {\bf PmagPy} tools.   The \href{http://earthref.org/MAGIC/search/}{\bf MagIC} search interface provides a rich variety of search filters available by clicking on the `Filter the MagIC Search Results' text box.    To locate data from a particular reference,  simply substitute the digital object identifier (DOI) in your browser window:

\href{http://earthref.org/MAGIC/doi/10.1029/2003GC000661}{http://earthref.org/MAGIC/doi/10.1029/2003GC000661}

\noindent The above DOI will find the data for the paper by \cite{tauxe04b}.  [This may fail in Safari; if so, use an alternative browser like Firefox or Chrome.]     To download the data, simply click on the file icon labeled ``Download''.  This will save a file to your downloads folder.
 To unpack this file after downloading it from the database, open \href{#pmag_gui.py}{Pmag GUI} and click ``unpack downloaded txt file``.


 \section{Preparing for MagIC}

\customlink{field_info}

\subsection{Field and sampling information}

 There is an astounding number of different ways that paleomagnetists document data in the field and in the lab. This variety is met with a large number  of method codes that describe sampling and orientation procedures (see \url{https://earthref.org/MagIC/method-codes} for a complete description).   The MagIC database expects sample orientations to be the azimuth and plunge of the fiducial arrow used for measurement (see  \href{http://earthref.org/MAGIC/books/Tauxe/Essentials/WebBook3ch2.html#ch2}{[Essentials, Chapter 9]} )  and the orientation of the bedding to be dip direction and downward dip so no matter what your own preference is, it must be translated into the standard MagIC convention for use with the PmagPy programs and with \href{#pmag_gui.py}{Pmag GUI}.

\href{#pmag_gui.py}{Pmag GUI}  supports two different ways of getting orientation and other sampling related information into a MagIC usable format.  The first way is through \href{#orient}{step 2 on the GUI front panel} and filling in the data from within the GUI.  That way will work for many applications, but it may be desirable to fill the spreadsheet in separately from the GUI by using  a tab delimited file (orient.txt format).   By clicking on  \href{#orient}{step 2 on the GUI front panel}  you create a file named {\it demag\_orient.txt}  which has all of your sample names in it.   Each {\it orient.txt} file should  have all the information for a single location {\it sensu MagIC}.


  \includegraphics[width=15cm]{EPSFiles/orient.eps}

 The next row has the names of the columns.  The required columns are:  sample\_name, mag\_azimuth, field\_dip, date, lat, long, sample\_lithology, sample\_type, sample\_class) but there are a number of other possible columns (e.g., Optional Fields in orient.txt formatted files are: [date, shadow\_angle, hhmm], date, stratigraphic\_height, [bedding\_dip\_direction, bedding\_dip], [image\_name, image\_look, image\_photographer], participants, method\_codes, site\_name, and site\_description, GPS\_Az]).  Column names in brackets must be supplied together and the data for stratigraphic\_height are in meters.  Also note that if these are unoriented samples, just set mag\_azimuth and field\_dip to 0.

% If there is a simple  and consistent relationship between the site name and the sample name (e.g., sample ns034a belongs to site ns034), you do not need to specify a site name here as it will be parsed by \href{#orientation_magic.py}{orientation\_magic.py} when it gets converted  to the MagIC format.  However, many investigators have no such consistent naming scheme.  Moreover, in some cases,  groups of samples or initial site designations need to be re-grouped for averaging.  For example, if it becomes clear that a sequence of lava flows were erupted over a short period of time and should be averaged together, you would need a new site name for all the samples.  Note that there are different understandings of the term {\bf site} in the paleomagnetic community.  We adhere to the MagIC definition of ``site'', which is:
% \begin{quote}
%site: a group of samples that are homogeneous with respect to the property being measured.
%\end{quote}
%\noindent When a site  has no simple relationship to the sample names, a column named  site\_name in the {\it orient.txt} file can be used  with the site name filled in for every sample.

   It is handy  to document the lithology, type and material classification information required by MagIC. These  are all controlled vocabularies listed at \url{http://earthref.org/MAGIC/shortlists.htm}.   For archaeological materials, set the lithology to ``Not Specified''.

   Put in stratigraphic height, sun compass, differential GPS orientation information under the appropriate column headings.  You can also flag a particular sample orientation as suspect, by having a column 'sample\_flag' and setting it to either 'g' for good or 'b' for bad.  Other options include documenting digital field photograph names and who was involved with the sampling.

 For Sun Compass measurements, supply the shadow\_angle, date and time. The date must be in mm/dd/yy format. If you enter the time in local time, be sure you know the offset to Universal Time as you will have to supply that when you import the file. Also, only put data from one time zone in a single file. The shadow angle should follow the convention shown in this figure (from Tauxe et al., 2010): \nocite{tauxe10}

  \includegraphics[width=15cm]{EPSFiles/suncomp.eps}

  \customlink{orientation_schemes}

{\bf Supported sample orientation schemes:}

  There are options for
 different orientation conventions (drill direction with the Pomeroy orientation device  [drill azimuth and hade] is the default), different naming conventions and a choice of whether to automatically calculate the IGRF value for magnetic declination correction, supply your own or ignore the correction.  The program generates or updates {\it samples.txt} and {\it sites.txt} files.

 All images, for example outcrop photos are supplied as a separate zip file. image\_name is the name of the picture you will import, image\_look is the ``look direction`` and image\_photographer is the person who took the picture. This information will be put in a file named {\it images.txt} and will ultimately be read into the images table.

Often, paleomagnetists note when a sample orientation is suspect in the field. To indicate that a particular sample may have an uncertainty in its orientation that is greater than about 5$^{\circ}$, enter SO-GT5 in the method\_codes column and any other special codes pertaining to a particular sample from the method codes table. Other general method codes can be entered later. Note that unlike date and sample\_class, the method codes entered in orient.txt pertain only to the sample on the same line.

Samples are oriented in the field with a ``field arrow`` and measured in the laboratory with a ``lab arrow``. The lab arrow is the positive X direction of the right handed coordinate system of the specimen measurements. The lab and field arrows may not be the same. In the MagIC database, we require the orientation (azimuth and plunge) of the X direction of the measurements (lab arrow). Here are some popular conventions that convert the field arrow azimuth (mag\_azimuth in the orient.txt file) and dip (field\_dip in orient.txt) to the azimuth and plunge of the laboratory arrow (sample\_azimuth and sample\_dip in samples.txt). The two angles, mag\_azimuth and field\_dip are explained below.

{\parindent 0pt
[1] Standard Pomeroy convention of azimuth and hade (degrees from vertical down) of the drill direction (field arrow). sample\_azimuth = mag\_azimuth; sample\_dip =-field\_dip.

  \includegraphics[width=15cm]{EPSFiles/orcon_1.eps}

  2] Field arrow is the strike of the plane orthogonal to the drill direction, Field dip is the hade of the drill direction. Lab arrow azimuth = mag\_azimuth-90$^{\circ}$; Lab arrow dip = -field\_dip

    \includegraphics[width=15cm]{EPSFiles/orcon_2.eps}

  [3] Lab arrow is the same as the drill direction; hade was measured in the field. Lab arrow azimuth = mag\_azimuth; Lab arrow dip = 90$^{\circ}$-field\_dip.

      \includegraphics[width=15cm]{EPSFiles/orcon_3.eps}

  [4] Lab arrow orientation same as mag\_azimuth and field\_dip.

        \includegraphics[width=15cm]{EPSFiles/orcon_4.eps}

        [5]  Lab arrow azimuth is  mag\_azimuth and lab arrow dip is the  field\_dip-90$^{\circ}$

               \includegraphics[width=15cm]{EPSFiles/orcon_5.eps}


 [6] Lab arrow azimuth is mag\_azimuth-90$^{\circ}$, Lab arrow dip is 90$^{\circ}$-field\_dip, i.e., the field arrow was strike and dip of orthogonal face:

                \includegraphics[width=15cm]{EPSFiles/orcon_6.eps}
                }

{\bf Structural correction conventions:}


Because of the ambiguity of strike and dip, the MagIC database uses the dip direction and dip where dip is positive from 0 $\rightarrow$ 180. Dips$ > $90 are overturned beds.


 \customlink{naming_schemes}

{\bf Supported sample naming schemes:}

\begin{verbatim}
            [1] XXXXY: where XXXX is an arbitrary length site designation and Y
                is the single character sample designation.  e.g., TG001a is the
                first sample from site TG001.    [default]
            [2] XXXX-YY: YY sample from site XXXX (XXX, YY of arbitary length)
            [3] XXXX.YY: YY sample from site XXXX (XXX, YY of arbitary length)
            [4-Z] XXXX[YYY]:  YYY is sample designation with Z characters from site XXX
            [5] site name = sample name
            [6] site name entered in site_name column in the orient.txt format input file
            [7-Z] [XXX]YYY:  XXX is site designation with Z characters from samples  XXXYYY
\end{verbatim}

When you are finished with editing the {\it orient.txt} file,  return to  \href{#orient}{step 2 on the GUI front panel}.


\customlink{magnetometer_files}

\subsection{Supported Rock Magnetometer files}

The MagIC database is designed to accept data from a wide variety of paleomagnetic and rock magnetic experiments. Because of this the magic\_measurements table is complicated. Each measurement only makes sense in the context of what happened to the specimen before measurement and under what conditions the measurement was made (temperature, frequency, applied field, specimen orientation, etc). Also, there are many different kinds of instruments in common use, including rock magnetometers, susceptibility meters, Curie balances, vibrating sample and alternating gradient force magnetometers, and so on. We have made an effort to write translation programs for the most popular instrument and file formats and continue to add new supported formats as the opportunity arises. Here we describe the various supported data types and tell you how to prepare your files for importing. In general, all files for importing should be placed in the MyFiles directory or in subdirectories therein as needed.  If you don't see your data type in this list, please send an example file and a request to:  ltauxe@ucsd.edu and we'll get it in there for you.


The supported file formats are:

{\bf Rock Magnetometer Files:}

\begin{itemize}
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#_2g_asc_magic}{\_2g\_asc\_magic} : convert the 2G ascii file to MagIC - but no example yet.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#_2g_bin_magic}{\_2g\_bin\_magic} : convert 2G binary format to MagIC
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#agm_magic}{agm\_magic} : convert Princeton Measurements alternating gradient force magnetization (AGM) output files to the MagIC format.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#bgc_magic}{bgc\_magic} : convert the Berkeley Geochronology lab format to MagIC.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#cit_magic}{cit\_magic} : convert the Cal Tech file format.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#generic_magic}{generic\_magic} : convert the generic file format to MagIC.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#huji_magic}{huji\_magic} : convert Hebrew University, Jerusalem, Israel file format to MagIC.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#huji_sample_magic}{huji\_sample\_magic} : convert the HUJI sample file to a MagIC format.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#jr6_jr6}{jr6\_jr6\_magic} : convert the AGICO JR6 spinner .jr6 output to MagIC
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#jr6_txt_magic}{jr6\_txt\_magic} : convert the AGICO JR6 txt format to MagIC
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#k15_magic}{k15\_magic} : convert  15 measurement anisotropy of magnetic susceptibility file format to MagIC.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#ldeo_magic}{ldeo\_magic} : convert Lamont-Doherty file format to MagIC.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#livdb_magic}{livdb\_magic} : convert Liverpool file format to MagIC.
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#mst_magic}{mst\_magic} : convert Curie Temperature experimental data to MagIC
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#sio_magic}{sio\_magic} : convert the Scripps Institution of Oceanography data format to MagIC
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#sufar4_magic}{sufar4\_magic} : convert the AGICO SUFAR program (ver.1.2.) ascii file format to MagIC
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#tdt_magic}{tdt\_magic} : convert the Thellier Tool format to MagIC 3.0
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#utrecht_magic}{utrecht\_magic} : convert the Fort Hoofddijk, Utrecht University Robot file format to MagIC
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#orientation_magic}{orientation\_magic} : convert an "orient.txt" formatted file with field notebook information into MagIC formatted files
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#azdip_magic}{azdip\_magic} : convert an "azdip" formatted file to a samples.txt file format
\end{itemize}


\customlink{anisotropy_files}

{\bf Anisotropy of Magnetic Susceptibility files:}

\begin{itemize}
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#s_magic}{s\_magic} : convert the 6 tensor element format (.s) to MagIC
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#kly4s_magic}{kly4s\_magic} : convert the AMSSpin format of Gee et al. 2008 to MagIC
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#k15_magic}{k15\_magic} : convert  15 measurement anisotropy of magnetic susceptibility file format to MagIC. \nocite{tauxe98}
\item \href{http://pmagpy.github.io/PmagPy_MagIC.html#sufar4_magic}{sufar4\_magic} : convert the AGICO SUFAR program (ver.1.2.) ascii file format to MagIC

\end{itemize}

\customlink{Hysteresis_file_formats}

\subsubsection{Hysteresis file formats}
{\bf Pmag GUI} will import hysteresis data from room temperature  Micromag alternating gradient magnetometers (AGM)  in several different ways.  You can import either hysteresis loops or backfield curves, or you can import whole directories of the same.  In the latter case, the file endings must be either .agm (.AGM) or .irm (.IRM) and the first part of the file must be the specimen name.
 See the documentation for  \href{http://pmagpy.github.io/PmagPy_MagIC.html#agm_magic}{agm\_magic} for examples.


Now you've collected together all the files you need, we can start importing them into {\it MagIC} directory with   \href{#convert2magic}{\bf Step 1 in Pmag GUI}.



\customlink{magic_gui.py}

\chapter{MagIC GUI Tutorial}
\label{chap:MagIC GUI}

{\bf MagIC GUI} is a Graphical User Interface written by Lori Jonestrask.  It is meant for efficiently compiling a contribution for uploading to the MagIC database.  MagIC GUI is specifically designed for making a contribution without measurement data; if you ARE including measurement data, we recommend that you use \href{#pmag_gui.py}{Pmag GUI} instead.
MagIC GUI allows you to add data at the location, site, sample, and specimen levels.  You can also add results and ages.  The program uses an Excel-like grid interface for entering and editing data.  Useful features include: pop-up menus with controlled vocabularies, multi-cell pasting from external spreadsheets, and built-in validations for MagIC database requirements.
Note: {\bf magic\_gui.py} uses the current MagIC data model, 3.0.  For working with legacy data in the 2.5 format, you should instead use {\bf magic\_gui2.py}.  The tutorial below was written specifically for the older  {\bf magic\_gui2.py} but will soon be updated with illustrations and instructions from {\bf magic\_gui.py}. The two programs do work almost identically, so the tutorial should still point you in the right direction even if you are working with 3.0 data.


\section{Starting with MagIC GUI}
Start up MagIC GUI.  You'll do this by clicking on the icon (if you downloaded the \href{#standalone}{standalone} version) or entering `magic\_gui.py' on your \href{#command_line}{command line} (if you downloaded the full PmagPy installation).  If you are using Anaconda Python, you will type `magic\_gui\_anaconda' on your \href{#command_line}{command line} instead.

When you first start {\bf magic\_gui.py}, you will change directories into a  `Project Directory'. For each study, create a directory with a name that relates to that study. Here we will call it {\it MyProject}.  This is where you will collect  and process all the rock and paleomagnetic data for a given study, usually a publication.   The project directory name should have NO SPACES and be placed on the hard drive in a place that has NO spaces in the path. Under certain Windows versions, this means you should not use your home directory, but create a directory called for example: D:$\backslash$MyPmagProjects and put {\it MyProject} there.

  \includegraphics[width=25cm]{EPSFiles/MM_main_frame.eps}

\section{MagIC GUI example dataset}
Now we'll walk through a simple data input process, with fake data.
  \begin{itemize}
  \item Start by clicking on `1. add location data'.  Enter location data as seen below. Notice use of the context menu: in most instances, these will provide controlled vocabularies.
    \includegraphics[width=40cm]{EPSFiles/MM_location_grid_with_menu.eps}
  \item You'll notice that some information is not filled in.  First, if you have no outside citations, you can leave `citations' blank and it will be automatically filled in with `This study' after you save this data.  Second, if you will be providing latitude/longitude for sites, then you don't need to provide it at the location level.  The program will extract start and end latitude and longitude from your site data and apply it to each location.
  \item If you want to provide more than the default required information, you may want to add more columns to your grid.  In our case, we'll add in `Country'.  To do this, just click the button `Add additional columns'.  Choose whatever headers you want to add and select `Ok'.

    \includegraphics[width=15cm]{EPSFiles/MM_add_location_headers.eps}

  \item Now you'll have a new column with a new controlled vocabulary.  Find and select `U.S.A.'.  When you're done entering location data, click `Save and close grid'.

  \item Next, we'll add in sites, so start by opening the site grid.  We will have two sites in this dataset, so click the `Add row(s)' button once.  Then, fill in the grid.  For some of the values, both sites will have the same value.  To provide this data more efficiently, click on the column label to edit all values in that column.  If that column has a menu, you can then click anywhere in that column and make a selection for every cell in the column. Once you're done editing the column, click the header again to exit the multiple-cell-edit mode.
  \item For controlled vocabulary columns, like `type', it is possible that you might not be able to find an appropriate value, or you might not know the appropriate value.  In that case, most controlled vocabularies provide a `Not Specified' option, which we will use here.

    \includegraphics[width=40cm]{EPSFiles/MM_site_grid_with_edit_all.eps}

  \item Once you're done adding sites, save and close the site grid, then open the sample grid.
    Enter data as you see below:

    \includegraphics[width=40cm]{EPSFiles/MM_sample_grid.eps}

    All other required data will fill in automatically.  If you don't provide latitude and longitude data for a sample, it will propagate down from the site after you save and close the grid.

  \item For samples, we will add an additional statistic.  Click 'Add additional columns' and select `sample\_int\_sigma' from the 'Headers for interpretation data' column.  Select 'ok' and have a look at your new grid.  You'll notice that the column you selected has been added, as well as two additional columns: `magic\_instrument\_codes' and `magic\_method\_codes++'.  These two columns are required if you are including any interpretation data at the sample level.  Fill in the added columns.  You'll notice that `magic\_method\_codes++' has a drop-down menu.  If you aren't familiar with the MagIC codes system, click `Show method codes' which provides brief explanations for each possible code.

    \includegraphics[width=50cm]{EPSFiles/MM_sample_grid_added_cols.eps}

  \item Save and close the sample grid, then re-open it to see how the data have propagated (re-opening the grid isn't necessary for the program, this is just for you to see what MagIC GUI does automatically).

    \includegraphics[width=50cm]{EPSFiles/MM_sample_grid_propagated_full.eps}

  \item In this example, we won't add data at the specimen level, so we will be skipping step 4.  Adding specimens works just the same as adding samples.

  \item Now open the age grid.  You can assign ages at any level, at multiple levels, or at no level.  For this study, we will add ages at the sample level.  Choose sample as the age level.  Next, you'll need to add in the `age' column.  Fill in the grid as below:

    \includegraphics[width=25cm]{EPSFiles/MM_age_grid.eps}

  \item You'll notice that you can't add or remove rows in this grid.  If you want to add an additional sample, you would need to go back to the sample grid to do so.

  \item The last data step is to put in result information.  You'll need to open the result grid and, for this example, add just one statistic: `vadm'.  Then, fill out the grid:

    \includegraphics[width=45cm]{EPSFiles/MM_result_grid.eps}

  \item For each result, you will add one or more items that the result pertains to.  In this example, one result is a site V[A]DM, and the other is an averaged V[A]DM from both sites.  For now, leave magic\_method\_codes blank for the Averaged V[A]DM result: in a minute we'll see how MagIC GUI catches this error.  Save and close the result grid.

  \item Next, you will create a MagIC format upload file.  Click the final button on the main frame, `prepare upload txt file'.  Depending on the size of your contribution, this can take a minute; with our small example, it should be fairly quick.  After hitting upload, you will see an error message, and the main frame will direct you to the problem.  Validations will check for missing required fields, invalid data, and missing ancestors (for instance, a specimen with no sample).

    \includegraphics[width=25cm]{EPSFiles/MM_validation_mainframe.eps}

    Open the result grid to fix the error.  Click `Show help' for more information about validations.  In this case, it is a simple fix: add method code `LP-PI' to the average V[A]DM result.

    \includegraphics[width=45cm]{EPSFiles/MM_filled_in_result_validation.eps}

  \item Now that you've fixed your error, try `prepare upload txt file' again.  This time there should be no problems, and you are ready to \href{#magic_upload}{upload your data}!

\end{itemize}




%
%
\customlink{MagIC.py}
%
%\chapter{MagIC.py}
%\label{chap:MagIC} \href{#MagICDatabase}{[MagIC}]
%
%While \href{#pmag_gui.py}{Pmag GUI} provides a bare bones interface for importing, interpreting and uploading most demagnetization and paleointensity experimental data into the MagIC database, {\bf MagIC.py} is a more complete (and complicated) program.
%It is an umbrella program that links many MagIC related functions of the \href{#PmagPy}{PmagPy} Software Package in a user-friendly  graphical user interface (GUI).  While it is invoked with a command line call, this  can be done from any directory (with no spaces in the path).  It generates calls to the programs described in Chapter~\ref{chap:PmagPy} so you don't have to.    It allows importing of many lab and instrument formats, plotting of a variety of data and doing the data processing and book-keeping required to create files ready for uploading into the MagIC Console software.

\chapter{Graphical data analysis programs}
\customlink{demag_gui.py}
\section{demag\_gui.py}

The  Demag GUI ({\bf demag\_gui.py}) program enables the display and analysis of paleomagnetic demagnetization data. The software will display specimen level data within the chosen directory as a Zijderveld plot, equal area plot and intensity plot. Interpretations can be made to the data as least-squares line or plane fits. Mean directions can be calculated and displayed for these interpretations. These interpretations can be exported as MagIC tables.

\subsubsection{Launching}\label{launching}

The best way to launch the Demag GUI application is through  \href{#pmag_gui.py}{Pmag GUI}. If you have installed PmagPy using pip, (or completed a developer install), you can run `pmag\_gui.py' at the command line to launch it.  Anaconda users will instead use `pmag\_gui\_anaconda'.

\noindent To use Demag GUI, you must have a MagIC format measurements file.  You can convert other lab formats to MagIC format within \href{#pmag_gui.py}{Pmag GUI}.  Click through step 1 in \href{#pmag_gui.py}{Pmag GUI} to import all of your files and then combine them into a `measurements.txt' file (and possibly specimen, sample, site, and location files as well).  Once you have converted all of your files, click on the Demag GUI button in \href{#pmag_gui.py}{Pmag GUI}.


\noindent If you want to launch {\bf Demag GUI} directly, (assuming {\bf PmagPy} was properly installed using pip or developer install), you can simply type `demag\_gui.py' at the command line. Anaconda users will type `demag\_gui\_anaconda' instead.


\includegraphics[width=10 cm]{EPSFiles/demag_gui_QuickMagicLauncher.eps}

\noindent {\bf Demag GUI} can also be launched through the command line by navigating to the directory containing {\bf demag\_gui.py}  and running it with:\\

\begin{verbatim}
% python ./demag_gui.py
\end{verbatim}


%\begin{verbatim}
% pythonw ./pmag_gui.py
%\end{verbatim}

\subsubsection{Adding and Editing Specimen Interpretations:}\label{adding-interpretations}

To add a new fit, click the `add fit' button (hotkey: ctrl-n).  (For Mac users, all hotkeys use the Command button instead of Ctrl.)  If no fit has yet been created for the current specimen, you add a new fit by double clicking on two measurements in the list of measurements to the left, or by double clicking on the data points on the zijderveld plot.  You can manage multiple fits for the same specimen, switching between them using the drop-down-menu under the add fit button.  Once you have selected a fit, the shape of the end points of the selected fit will turn to diamond shapes on all plots to distinguish them from the other data points.  It is also possible to add interpretations in mass using the \hyperref[interpretation-editor]{interpretation editor} tool described below.

\includegraphics[width=10 cm]{EPSFiles/demag_gui_Fit.eps}

\noindent Once the desired fit is selected, its bounds can be edited using the drop-down boxes under the bounds header.\\

\includegraphics[width=3 cm]{EPSFiles/demag_gui_BoundsBox.eps}

\noindent Another way to edit bounds is to double-click the list of measurement steps in the list on the left. The included steps in the currently selected interpretation are highlighted blue on the measurement list and the measurements marked ``bad'' are highlighted red. Bad measurements can be marked and unmarked by right clicking on them (this change takes a moment to appear, see more details below).  In the case of duplicate measurements, the first \emph{good} measurement with the same treatment is used as a bound. All points between the selected bounds that are flagged good (i.e. not flagged bad and marked in red), including duplicate measurements, will be included in the interpreted fit.\\

\includegraphics[width=5 cm]{EPSFiles/demag_gui_DataBox.eps}

\noindent Finally, you can select the bounds of an interpretation directly off the Zijderveld plot by hovering your mouse over a measurement (should change to a hand shape) and double clicking.\\

\noindent When first created, the fit will be given a generic name such as
\emph{Fit 1}. The name of the fit can be changed from the default by typing into the drop-down box containing fit name. The default fit type is a least-squares line. You can choose different fits, such as a line anchored to the origin or a plane, by using the drop-down menu in the `Interpretation Type' box. Plane fits can be plotted as either poles, full planes, partial planes, best fit vectors, or best fit vectors and full plane ({\bf Note:} plane poles will be displayed as squares and best fit vectors will display as sideways triangles on \hyperref[higher-level-plots-and-interpretation]{high level mean plot}). This display option can be changed in the second drop-down menu in the `Interpretation Type' box.\\

\includegraphics[width=10 cm]{EPSFiles/demag_gui_SpecimenMeanType.eps}

\noindent The properties of the currently selected fit to the data can be seen in the upper center of the GUI in a box labeled `Interpretation Directions and Statistics'.\\

\includegraphics[width=10 cm]{EPSFiles/demag_gui_FitData.eps}

\subsubsection{Deleting Specimen
Interpretations}\label{deleting-specimen-interpretations}

\noindent If you would like to delete a single interpretation, select the one you wish to delete from the interpretation drop-down menu and click `delete fit'. If you wish to clear all interpretations you may go into the \hyperref[interpretation-editor]{interpretation editor} located under the tools menu, select the fits you wish to delete and click the ``delete selected'' button.\\

\subsubsection{Changing Specimen, Coordinate System, and Zijderveld Direction:}\label{change-specimen-coord-zijd}

You can switch current specimen by clicking the next or previous button under the specimen box in the side bar (hotkey: ctrl-right and ctrl-left respectively). You can also select specimen from the drop-down menu or type the name of the specimen directly into the specimen box and hit enter to go directly to that specimen. Finally, you can double click on any of the points on the higher level means plot to switch directly to that specimen and interpretation.

\noindent The choice between coordinate systems (i.e.~specimen, geographic or tilt-corrected) is available on the left above the list of measurements. The data list and the plots will update to reflect the chosen coordinate system.

\noindent You can alter the X axis of the Zijderveld plot using the Zijderveld Plot Options box to set X=North, East, or NRM dec (found above the list of measurements).

\includegraphics[width=5 cm]{EPSFiles/demag_gui_ProjectionChoice.eps}

\subsubsection{Flagging Bad Measurement Data}\label{flagging-bad-measurement-data}

Due to flux jumps or other such errors, individual measurements should sometimes be excluded from interpretation. Such measurements can be flagged as ``bad'' by right clicking them within the measurement list and the measurement will then be highlighted in red. Additionally, you can double right click on the point you want to make bad in the Zijderveld plot to toggle it bad. The measurement\_flag in the magic\_measurements file will be change from ``g'' to ``b'' when a measurement is marked as bad the step will not be included in fits that are made to the data. Any measurement marked as bad will be colored red in the step list and will be shown as an empty rather than filled circle on the Zijderveld, equal area and M/M\_0 plots. To change a bad measurement back to being good, one can right click on it again. Upon doing so, the red highlighting will go away, the data will be shown colored in within the plots and any fit that spans that data point will be recalculated to include it.

\noindent Acceptance criteria can be set by using the menu option [Analysis] $\rightarrow$ [Acceptance
Criteria] $\rightarrow$ [Change Acceptance Criteria]. These criteria will be written to a {\it criteria.txt}  table. These criteria can then be used to exclude interpretations that fail checks against this criteria during export.

\subsubsection{Plot Interface}\label{plot-interface}

The four plots that take up the majority of the center of the GUI are where data and their interpretations are displayed. All plots are initially set to zoom mode and this is signified by a cross shaped cursor when you mouse over them. To zoom simply click and drag the rectangle to the desired area. You can switch to pan mode by right clicking on any one of the graphs and then clicking and dragging will pan around the plot. Finally, to return to the original plot zoom level and position simply click the middle mouse button to return home. \textbf{Note:} In the absence of a middle mouse button pressing both right and left mouse buttons at the same time works on most laptops.  In the case of Mac laptops, clicking with two fingers may work.  If it doesn't, you will need to switch to a different specimen or change the interpretation bounds to cause the figure to reload.

\noindent On the Zijderveld plot you have the additional option to select the current interpretation's bounds by double clicking on a measurement point. You can also double right click on a measurement point in the zijderveld plot to mark it bad (this second option may not work on all systems).

\noindent On the equal area plots, both for the specimen and high level means, you can double click on any interpretation to switch to that specimen and interpretation immediately.

\subsubsection{Saving Specimen Interpretations}\label{saving-specimen-interpretations}

Once you have picked out your interpretations, you can save the session data in two different ways: (1) as a .redo file which will allow you to have the fits preserved to be view again with Demag GUI or (2) as MagIC tables (at the specimen/sample/site levels) to be uploaded to the MagIC database or otherwise processed. In addition, you may save image files of the plots.

\paragraph{The .redo File:}\label{the-.redo-file} You can use the menu option [File] $\rightarrow$ [Save current interpretations to a redo file] to create this file type, you can just click the save button next to add fit, or you can use the hotkey ctrl-s. The advantage of the .redo file type being that it is designed to save your place when analysing a large dataset. Loading a redo file will reload all interpretations previously created any special colors assigned to them and take you to the specimen you saved the redo file on allowing you to pick up where you left off. \textbf{Note:} This file type does \textbf{NOT} load previous interpretations on start up you must go to the menu option [File] $\rightarrow$ [Import previous interpretations from a redo file] (hotkey: ctrl-r) to restore your previous session.

\paragraph{The MagIC Tables:}\label{the-pmag-tables} By going to the menu [File] $\rightarrow$ [Save MagIC Tables] you can export your interpretations made in Demag GUI to the MagIC tables which can then be used by other MagIC programs or uploaded to the MagIC database. You can export any or all of the three coordinate systems upon selecting this option and you may choose to save {\it samples} and {\it sites}  tables in addition to the {\it specimens } table that is output. If you choose to output additional information you will be prompted by a pop up window for additional information. \textbf{Note:} This save format loads on start up of the GUI immediately restoring your interpretations. Selection of this option will overwrite your {\it demag\_gui.redo} file in the working directory.

\paragraph{Images of Plots:}\label{images-of-plots} Select the menu option [File] $\rightarrow$ [Save plot] $\rightarrow$ [Save all plots] to save all plots, or you can save any of the plots individually. If you zoom or pan any of the plots the shifted image will be saved, not the originally plotted image (although the plot will redraw and reset to the original image in the GUI).

\subsubsection{Flag Specimen Interpretations Good or Bad}\label{flag-spec-interps}

You can flag the current specimen interpretation (marked by large diamonds on all plots) good or bad by using the menu option [Analysis] $\rightarrow$ [Flag Interpretations]. The list of interpretations in the \hyperref[interpretation-editor]{interpretation editor} tool of Demag GUI can also be used to toggle interpretations good or bad in the same way that measurements can be marked good or bad in the measurement list, by right clicking on the entry you want toggled. This will change the shape of the interpretation to a small diamond on all plots, remove it from use in any higher level means, and mark the entry result\_quality `b' instead of `g' to signify this.

\subsubsection{Sample Orientation}\label{sample-orient}

You can check sample orientation by using the menu option [Analysis] $\rightarrow$ [Sample Orientation] $\rightarrow$ [Check Sample Orientations] (hotkey: ctrl-o). This function will set your mean options to fisher of all components at the current site level and display the wrong arrow (up triangle), wrong compass (down triangle), and rotated sample for declanation incraments of 5 degrees (dotted circle). This allows you to check if the sample orientation is correct and thus can be used in analysis. If you determine the current sample orientation to be bad you can mark it as such using the menu option [Analysis] $\rightarrow$ [Sample Orientation] $\rightarrow$ [Mark Sample Bad] (hotkey: ctrl-.). This will change the sample_orientation_flag in the er_samples file to b not g and will prevent you from marking the specimen interpretations good in that sample so you do not use the improperly oriented data in your final results. If you later realize this was a mistake you can mark the sample orientation good again using [Analysis] $\rightarrow$ [Sample Orientation] $\rightarrow$ [Mark Sample Good] (hotkey: ctrl-,). Finally, to turn off the check sample orientations data simply select the [Check Sample Orientations] option again and it will be removed. \textbf{Note:} The current sample is specified as the sample of the current specimen.

\includegraphics[width=10 cm]{EPSFiles/demag_gui_CheckSampleOrient.eps}

\subsubsection{High Level Means Plot and
Statistics}\label{higher-level-plots-and-interpretation}

The set of drop-down boxes to the right of the interpretation data are there to determine what level you want to analyse in the high level means plot and are grouped into the Display Level and Mean Options boxes.

\includegraphics[width=8 cm]{EPSFiles/demag_gui_HighLevel.eps}

\noindent The Display Level boxes consist of the upper drop-down menu which allows you to select the level at which interpretations are displayed options being all interpretations in the current: sample, site, location, or study. The lower drop-down menu lets you select the current sample, site, location, or study.

\noindent The top drop-down menu in the Mean Options box lets you chose what kind of mean you would like to take of the specimen components currently displayed. The lower drop-down menu lets you pick which specimen components to display allowing you to display All components, No components, or any single component.

\noindent The mean statistics for the chosen high level mean are displayed in the lower right of the GUI and can be cycled through using the arrow buttons next to the statistics boxes in the case of multiple high level means.

\noindent It is possible to toggle on and off displaying any one of the means in the high level plot which can be useful in the case of a cluttered graph of all components. This can be done by going to the menu option [Analysis] $\rightarrow$ [Toggle Mean Display] and selecting the name of the component you would like to toggle.

\noindent All interpretations marked bad will appear as small diamonds regardless of type on the high level mean plot. The below gives examples for a number of plane display options of bad interpretations (the symbols off to the side), best fit vectors to the means (sideways triangles), plane poles (squares), and the planes themselves.

\includegraphics[width=30 cm]{EPSFiles/demag_gui_HLMTypes.eps}

\subsubsection{Interpretation Editor}\label{interpretation-editor} %Make this a lot larger

In order to more easily view and edit specimen interpretation data there is a specimen interpretation editor which can be launched using the menu option [Tools] $\rightarrow$ [Interpretation Editor] (hotkey: ctrl-e). \textbf{Note:} If you would like more help than provided here the interpretation editor has in context help same as the main GUI, see \hyperref[add-help]{additional help} for details.
\paragraph{List of Interpretations:}\label{IE-list} This panel contains a list which details the fits made to the data and their parameters from which you can select which interpretation to view by double clicking it. In the list, the currently selected interpretation is highlighted blue as shown in the image below. You can mark interpretations as bad which removes them from any Fisher means or other high level means by right clicking on their entry in the list. All interpretations marked bad are colored red in the list and marked as a small diamond on the plot. The specimen entry associated with this fit will be given a bad (`b') flag within the specimens table. You can search through interpretations by using the search bar above the list. Finally, interpretations can be highlighted by clicking on the list and holding the shift or ctrl/command key to select multiple interpretations.
\paragraph{Buttons and Boxes:}\label{IE-buttons} Highlighting entries allows you to delete or alter the characteristics of multiple interpretations at once without having to select each one in turn. This mass alteration is allowable using the the Name/Color/Bounds boxes to input the changes and then clicking the ``apply changes to highlighted fits'' button. You can delete highlighted fits using the ``delete highlighted fits'' button. The ``add fit to highlighted specimens'' button in the interpretation editor adds a fit to all highlighted specimens in the list on the left. You can use the ``add new fit to all specimens`` as a convenient option to add a new interpretation with all the attributes described in the above Name/Color/Bounds boxes to every specimen with measurement data. This is a useful method for quickly analysing a new dataset by checking for components between common unblocking steps like giving every specimen a general magnetite interpretation inferring about where that should be (e.g. bounds=300C to 580C, name=MAG, color=violet).
\paragraph{Additional High Level Means Options:}\label{IE-HLM-options} The interpretation editor also allows the displaying of site and sample means as the primary points on the high level mean plot by changing the bottom left display options drop-down box. The program does not yet allow taking fisher means of sample means or site means, so the mean type box will be forced to read ''None'' if this option is changed from specimens.

\includegraphics[width=15 cm]{EPSFiles/demag_gui_InterpEditor.eps}

\subsubsection{VGP Viewer}\label{vgp-view}

Another tool offered by Demag GUI is the VGP (Virtual Geomagnetic Pole) Viewer which allows you to view your VGPs before exporting to MagIC tables. Note: this is not available in the standalone executables.

The VGP viewer can be opened by using the menu option [Tools] $\rightarrow$ [View VGPs] (hotkey: ctrl-shift-v). The viewer requires latitude and longitude data for sites and locations in order to calculate all VGPs from specimen interpretations, if this data is not already contained in the MagIC tables imported when the GUI started then it will be asked for during calculation so have it ready. The VGP viewer allows you to select viewing samples, sites, or location VGPs from the drop-down menu at the top. Plot interactions are the same here as in the main GUI and can be zoomed, panned, and points selected in the same manner. The list on the left shows all the data for the currently displayed VGPs.

\includegraphics[width=15 cm]{EPSFiles/demag_gui_VGPViewer.eps}

\subsubsection{Current Warnings Box}\label{warn-box}

The white box in the far top right of the GUI is there to provide relevant warnings about aspects of the current specimen and interpretation such as missing data or duplicate data and can be useful in debugging and analysis.

\subsubsection{Additional Help}\label{add-help}

Finally, if you need more help working with Demag GUI it offers in context assistance with the menu option [Help] $\rightarrow$ [Usage and Tips] (hotkey: ctrl-h) which will change your cursor and then let you click on whichever aspect of the GUI you want help with. In most cases, a yellow pop-up box with information will appear, altough not all features have information.

\includegraphics[width=10 cm]{EPSFiles/demag_gui_ContextHelp.eps}

\customlink{thellier_GUI.py}

\section{thellier\_gui.py}
\href{http://earthref.org/MAGIC/books/Tauxe/Essentials/WebBook3ch10.html#ch10}{[Essentials Chapter 10]} and \href{#MagIC}{[MagIC}]
\href{https://github.com/PmagPy/PmagPy-Cookbook/blob/gh-pages/thellier_GUI_full_manual.pdf}{[Thellier\_GUI\_full\_manual.pdf]}

The program Thellier GUI ({\bf thellier\_gui.py})  combines functions from \href{#thellier_magic.py}{thellier\_magic.py} and new tools described by  \href{http://dx.doi.org/10.1002/ggge.20062}{Shaar and Tauxe (2013)} \nocite{shaar13} in a user-friendly graphical user interface (GUI).

As with \href{#demag_gui.py}{Demag GUI}, Thellier GUI can  be called from  the  \href{#command_line}{command line} or from within \href{#pmag_gui.py}{Pmag GUI}.

To launch Thellier GUI independently, find your command line and enter:

\begin{verbatim}
thellier_gui.py
\end{verbatim}

If using Anaconda Python, you will instead use:

\begin{verbatim}
thellier_gui_anaconda
\end{verbatim}

Once open, Thellier GUI loads  files already prepared in a  \href{#ThisProject}{This Project} directory and the interpretations from Thellier GUI are part of the workflow of  \href{#pmag_gui.py}{Pmag GUI}.   This section is a brief introduction on how to use Thellier GUI as a stand alone application. Much more information is available within this manual: \href{https://github.com/PmagPy/PmagPy-Cookbook/blob/gh-pages/thellier_GUI_full_manual.pdf}{Thellier GUI full manual}.

\noindent  A complete list of the definitions for paleointensity statistics used by Thellier GUI is available as a supplement to the article by \href{#http://dx.doi.org/10.1002/2013GC005135}{Paterson et al., 2014}  \nocite{paterson14} and available for download here:

  \url{http://onlinelibrary.wiley.com/store/10.1002/2013GC005135/asset/supinfo/ggge20412-sup-0001-suppinfoCORRECTED.pdf?v=1&s=e1c3ab0a86c942d1039f6d2e15496aa172dc86ec}

\customlink{choose_directory}
After launching the program,  a  ``choose project directory'' dialog window will appear as soon as the GUI is started.
%
%	\includegraphics[width=15cm]{EPSFiles/Screenshot_choose_directory.eps}
%
%
Your  \href{#Project_Directory}{ThisProject} directory should include a file named {\it magic\_measurements.txt} (created for example by \href{#pmag_gui.py}{\bf Pmag GUI}.   If a file named {\it rmag\_anisotropy.txt} is in the project directory, then the program reads in the anisotropy data. Reading and processing the measurements files may take several seconds, depending on the number of the specimens.


\subsubsection{Reading and compiling measurements data}
When your \href{#Project_Directory}{ThisProject}  project directory is selected, the program  reads all the measurement data, checks them, processes them and sorts them. If non-linear-TRM (NLT) data exist in {\it magic\_measurement.txt}  then the program tries to process the data using Equations (1)-(3) in \href{http://dx.doi.org/10.7288/V4/MAGIC/12116}{Shaar et al., 2010}. \nocite{shaar10}  The program reads {\it measurement.txt}, and processes the measurements for presentation as Arai  and Zijderveld plots.
We recommend that you check all the warnings and errors in {\it Thellier\_GUI.log} before starting to interpret the data.  For details about warnings and error messages during these steps, consult the tutorial document in the {\it thellier\_GUI} folder in  {\it data\_files}.  Also, consult the Preferences to change certain plotting options.

\subsubsection{Main panel}

This figure shows a snapshot of the main panel.

  \includegraphics[width=30cm]{EPSFiles/Screenshot_main_panel.eps}

\noindent
  The top field in the  panel includes the following buttons/controls (from left to right):
  \begin{itemize}
\item {\bf Specimen:} a list of the specimens in the project folder sorted by name.
\item {\bf previous/next:} buttons to move forward and backward in the specimens list.
\item {\bf T min/T max:} buttons to select temperature bounds.
\item {\bf save/delete:} save or delete current interpretation. This information will be used later to generate a \href{#mk_redo.py}{redo file}.
\item {\bf B\_lab:} laboratory field in units of $\mu T$.
\item {\bf B\_anc:} specimen's paleointensity in units of $\mu T$.
\item {\bf Aniso Correction:} anisotropy correction factor.
\item {\bf NLT Correction:} Non-Linear TRM (NLT) correction factor.
\item {\bf Dec/Inc:} Specimen declination/inclination calculated by PCA of the NRM in the selected temperature bounds.
\item Sample mean, number of specimens, standard deviation and percent standard deviation.
\end{itemize}

The center of the main panel has these elements:

\begin{itemize}
\item {\bf measurements text panel:} Four columns of the measurement data: Step is ``N`` for NRM, ``Z`` for zero field step, ``I`` for infield step, ``P`` for pTRM check, and ``T`` for tail check. The temperature of each step is given in C. Also shown  declination, inclination and moment (in units of $Am^2$)
\item {\bf Arai plot:}  Arai plot normalized by $NRM_0$. blue circles are zero field steps, red circles are infield steps, triangles are pTRM checks, blue squares are tail checks. Temperatures are displayed near data points. Temperature bounds and best fit line are marked in green. 'SCAT box' is marked with dashed lines (only if SCAT is True).
\item {\bf Zijderveld plot:}  A Zijderveld plot of the NRM step.  The x axis is rotated to the direction of the NRM, blue is the x-y  projection, and red is x-z projection.
\item {\bf Equal area plot:}  An equal area projections  of the NRM steps. solid circles are positive inclination. open circles are negative inclinations.
\item {\bf Moment-temperature plot:}  NRMs are in blue, pTRMs are in red.
\item {\bf sample data:}  If at least two specimens have a saved interpretation, then their values are displayed on this plot. The mean $\pm$ standard deviation of the mean are marked as  horizontal lines.
\end{itemize}

The bottom of the main panel include paleointensity statistics. The first line has  the threshold values (empty if N/A). The second line is the specimen's statistics. For details see Appendix A1 in \href{http://dx.doi.org/10.1002/ggge.20062}{Shaar and Tauxe (2013)}. \nocite{shaar13}
%
%\subsubsection{ Tutorial by example}
% If you have not already done so, locate  the example data files for PmagPy in the \href{#Datafiles}{Datafiles} directory bundled with the {\bf PmagPy} software package.   There are two folders located in the{\it thellier\_gui} example foler: SU1\_example and Tauxe\_2006\_example.
%
%
%{Case study 1: SU1\_example:}
%
%Find your \href{#command_line}{ command line} and launch the program:
%\begin{verbatim}
%thellier_gui.py
%\end{verbatim}
%A \href{#choose_directory} {choose directory} dialog window will appear. Select the SU\_1 project directory and click on the ``choose'' button.
%
%\begin{itemize}
%\item{Manual interpretation}
%Manual interpretation is the conventional approach of selecting temperature bounds for each specimen. Here, as example, we will interpret one sample, su100601,  manually.
%\customlink{acceptance_criteria}
%
%\begin{itemize}
%\item Set acceptance criteria: From the menu-bar choose  Analysis $\rightarrow$ Acceptance criteria $\rightarrow$ Change acceptance criteria. A criteria dialog box will appear.
%\item In the first line (specimen's statistics) set the following values: n=3, int\_ptrm\_n=2, SCAT=false (unchecked), gap\_max=0.5, f\_vds=0.75, beta=0.1, MAD=6, DRATS=20. delete the values in the other boxes (empty boxes).
%\item In the second line (Sample's acceptance criteria) set the following values: int\_n=3. delete the value in the other boxes.
%\item In the third line (Sample mean calculation method: STDEV-OPT) check the Enable/Disable box, and set the following values: int\_sigma=6, int\_sigma\_perc=10. Delete values in the other boxes. Figure 3 shows how it should look. Click on the OK button. A message dialog will appear telling you the criteria that you chose are saved in a file name pmag\_criteria.txt. The next time you will open the GUI in this project directory, these criteria will automatically be chosen. Click OK on the message box.
%\item Manual interpretation of sample su100601: choose specimens su100601a from the specimen list. choose temperature bounds from the Tmin/Tmax windows: 200 and 580. B\_anc shows 61.7 in green, which means that this interpretation passes the specimen's acceptance criteria. Now, change Tmax to 530.  B\_anc window change color to red, and also the fvds window (the row on the bottom of the GUI). This is an indication that the interpretation did not meet the criterion for fvds. Change  Tmax to 580 (as before) and press ``save`` button. The interpretation in saved.
%\item Click on the next button to choose the next specimen (su100601b). Before analyzing this specimen, press on the ``previous`` button, so you can see that your previous interpretation was saved. click on ``next`` to return again to specimen su100601b. Find  temperature bounds that pass the criteria (for example 200,580). Make sure that all colors are green, and click on the ``save`` button. Go over all the other specimens in the sample (su10060a to su100601g). you will find that three specimens can pass: a,c, and g. Look at the Sample data figure (top right) it shows the saved interpretation for all the specimens in the sample, and the mean $\pm$  standard deviation of the mean.
%\item To save all your interpretation into files, choose from the menubar Analysis $\rightarrow$ Save current interpretation. Three files will be generated in the project directory:
%\begin{itemize}
%\item thellier\_GUI.redo (the temperature bounds for each specimen):
%\begin{verbatim}
%su100601a 473 853
%su100601c 473 853
%su100601g 473 853
%\end{verbatim}
%Note that the temperature bounds are in Kelvin.
%\item {\it thellier\_GUI.specimens.txt}: (the paleointensity statistics for each specimen - according to the headers. It is easy to view the content of this file using Excel):
%\begin{verbatim}
%su100601a	su100601	61.7	200	580	40.0	1.07	1.01	15	8	0.77	0.87	0.89	0.14	0.02	N/A	0.63	N/A	5.11	4.14	PASS
%su100601c	su100601	54.4	200	580	40.0	0.94	N/A	15	8	0.60	0.78	0.79	0.23	0.01	N/A	5.19	N/A	2.51	1.33	PASS
%su100601g	su100601	58.4	200	580	40.0	1.00	1.01	15	8	0.70	0.83	0.85	0.19	0.02	N/A	2.80	N/A	3.12	1.96	PASS
%\end{verbatim}
%\item {\it thellier\_GUI.samples.txt:} (the paleointensity statistics of the samples):
%\end{itemize}
%\begin{tabular}{cccccc}
%\hline
%er\_sample\_name &sample\_int\_n&sample\_int\_uT&sample\_int\_sigma\_uT&sample\_int\_sigma\_perc\\
%su100601 &	3&	58.2&	3.0&	5.1\\
%\hline
%\end{tabular}
%
%
%\item You can save the Arai plot (or any other plots) from the File menu. Choose  file  $\rightarrow$ Save Plot $\rightarrow$ Save Arai plot. A file dialog window will appear. You can change the format of the figure in the bottom tab (pdf, svg, or png), but you can also save as other format by adding the appropriate suffix to the file name.
%\item close the GUI: File  $\rightarrow$ Quit.
%\item Re-open the GUI as before (by writing the command  ``thellier\_gui.py''  in the terminal window) and choose the same working directory (SU1\_example). Notice now that the criteria that you set before are automatically used. To import your previous interpretations and continue working on this dataset choose from the menu bar Analysis $\rightarrow$ import previous interpretation. Choose thellier\_GUI.redo and click on the 'open' button.
%\end{itemize}
%
%\item{Automatic interpretation - \it{thellier\_auto\_interpreter:}}
%Instead of trying to find manually the most appropriate temperature bounds, the  {\bf thellier\_auto\_interpreter.py} program allows a fast and consistent way to choose the temperature bounds for the specimens. For details see \href{http://magician.ucsd.edu/~ltauxe/CV/open/shaar12.pdf}{Shaar and Tauxe (2012)}.  \nocite{shaar12}
%\begin{itemize}
%\item We will use the same \href{#acceptance_criteria }{acceptance criteria}.
%\item Choose from the menu bar Auto interpreter $\rightarrow$ Run Thellier auto interpreter. The interpreter will run approximately 30 seconds. When its done, a message window will appear saying that the interpreter finished successfully (if not, check for errors in the terminal window, or in a file name {\it thellier\_interpreter.log}  located in a folder named {\it thellier\_interpreter}. If the issue cannot be resolved send an e-mail with the description of the problem to rshaar@ucsd.edu). Click OK in the message window.
%\item The automatic interpretations are automatically saved, and we can review them on the Arai plots.  Let's look, for example, at the sample we interpreted  manually: su100601. Choose specimen su100601a from the specimens list. At first glance, the choice seems strange because the automatic interpretation chose temperature bounds 0 and 580. A choice between 200 and 580 may seem more reasonable as it provides an nearly straight line. The sample data figure explains this issue. The {\bf thellier\_auto\_interpreter.py} program chooses the interpretations that minimize the standard deviation of the sample's mean. Six specimens from this sample passed the criteria, and the value of su100601a is much higher than the remaining five. So, the thellier\_auto\_interpreter chose the 'acceptable' interpretation with the shallowest  slope. Go over the other specimens in the sample, and review the automatic interpretations. If you want, you can change the automatic interpretation, and save your own ``manual'' interpretation by choosing Analysis $\rightarrow$ Save current interpretation. Note that the output of {\bf thellier\_auto\_interpreter.py} is sensitive to the choice of the acceptance criteria, and different criteria may lead to significantly different final results.
%\end{itemize}
%\item{Choosing the optimal criteria - \it{thellier\_optimizer\_2d:}}
%\href{http://magician.ucsd.edu/~ltauxe/CV/open/shaar12.pdf}{Shaar and Tauxe (2012)} \nocite{shaar12} discuss a method to choose the optimal specimen's acceptance criteria. Here, we follow the example given in this paper. \href{http://magician.ucsd.edu/~ltauxe/CV/open/shaar12.pdf}{Shaar and Tauxe (2012)} suggested using  seven statistics for specimen's acceptance criteria. The choice of four of which is trivial, and the remaining three are MAD, FRAC and $\beta$. The thellier\_optimizer\_2D helps finding the optimal values for FRAC and $\beta$.  The thellier\_optimizer\_2D  required three types of inputs: 'fixed\_criteria``, ``test\_groups``, and ``test\_samples``, as described below:
%\begin{itemize}
%\item The test groups are defined in an ``er\_sample`` file. An example for this file is given in working folder SU-1 named  ``optimizer\_test\_groups.txt``. Open this file in Excel to understand its syntax. The first line is a general header. The rest of the file include sample name, group name, and comments.
%\item To run the optimizer choose from the menu bar Optimizer $\rightarrow$ Run Thellier optimizer. click OK in the  message dialog. The first step is setting the 'fixed\_criteria``. We choose for the specimen's criteria: n=3, int\_ptrm\_n=2,SCAT=checked, gap\_max=0.6, MAD=5.0. We choose for the sample's criteria:int\_n=3, int\_n\_outlier\_check=6, EnableSTDEV-OPT, int\_sigme\_uT=5, int\_sigma\_perc=6. The rest of the boxes should be empty. click OK. click OK on the message window that will appear.
%\item The thellier\_optimizer\_2D dialog window will appear. The first two rows of controls for choosing the range for $\beta$ and FRAC. choose beta from 0.05 to 0.15 in steps of 0.1 and FRAC from 0.7 to 0.9 in step of 0.02. \\
%Inert the following functions to the text panel:\\
%study\_sample\_n\\
%max\_group\_int\_sigma\_uT\\
%((max\_group\_int\_sigma\_uT $<$= 5) or (max\_group\_int\_sigma\_perc $<$= 6)) and  int(study\_sample\_n) \\
%click on the ``Check function syntax`` button. If there are no typos, then the text box below the button should be PASS.\\
%click on the ``Choose optimizer group file`` button. A file dialog window will appear. choose the file ``optimizer\_test\_groups.txt``. Click the button ``Run Optimizer`` to start. The runtime using these parameter is about 8 minutes. `
%\item All the output files of the optimizer are saved in a folder named ``optimizer`` (see section 4.4). Compare the figures in the 'pdf' folder with Figure 7 in \href{http://magician.ucsd.edu/~ltauxe/CV/open/shaar12.pdf}{Shaar and Tauxe (2012)}.
%\item The figure in optimization\_function\_2.pdf suggest using $\beta \leq$0.10 and FRAC  $ \geq $0.79. Set these values as acceptance criteria, and run thellier\_auto\_interpreter.
%\end{itemize}
%\end{itemize}


\customlink{MagICDatabase}
\chapter{The MagIC database and file formats}

A number of the programs in {\bf PmagPy} were  developed to take advantage of the MagIC database and aid getting data in and out of it.   So, we need some basic understanding of what MagIC is and how it is structured.
MagIC  is part of the EarthRef.org collection of databases and digital reference material.
Anyone interested in the MagIC database should first become a registered EarthRef.org user.  To do this, go to \url{http://earthref.org} and click on the {\bf Register} link in the {\bf Topmenu}.   Registration is not required for access to data or browsing around, but is required for uploading of data into the MagIC database, something which we sincerely hope you will have a chance to do.
%By registering, you will also be kept informed of our progress through bi-monthly newsletters and other email alerts.
After you register, go to \url{http://earthref.org/MAGIC/search}.


You can \href{#magic_download}{download data} using the \href{http://earthref.org/MAGIC/search}{MagIC search} website.
%Data from a particular reference can be found by typing the digital by typing in the author's name in the ``Reference Text Search'' box, or search by any column with a little magnifying glass icon.   If you click on the   You can show or hide columns  and look at data at various levels (location, site, sample, and so on to retrieve the data you want.
%  Once the data you want have been identified, you can download the data by clicking on the `Save Results' button.
%
%    \includegraphics[width=15cm]{EPSFiles/MagIC_search.eps}
%
%
       After downloading, the data can be unpacked and examined using various tools in the {\bf PmagPy}  package, for example using \href{#pmag_gui.py}{Pmag GUI}.

\customlink{Uploading}
%
%\section{Uploading data to the database}

Paleomagnetic and rock magnetic data are collected and analyzed in a wide variety of ways with different objectives.  Data sets can be extremely large or can be the barest boned data summaries published in legacy data tables.   The goal of MagIC has been to have the flexibility to allow a whole range of data including legacy data from publications or other databases to new studies which include all the measurements, field photos, methodology, and so on.  The general procedure for the future will be to archive the data at the same time that they are published.    So, to smooth the path, it is advisable to put your data into the MagIC format as early in the process as possible.  All data that enters the database must be converted to the standard MagIC format either as a set of MagIC tables, or as one combined text file.    These can then be uploaded into the MagIC database.
%Here,  we illustrate the use of  a number of programs (the \href{#PmagPy}{PmagPy}  package in Python) to facilitate the `behind the scenes' process of making MagIC formatted tables.

\customlink{DataTables}

\section{Structure of the database tables}

The MagIC database is organized around a series of data tables.  The complete data model can be found here:
\url{https://www2.earthref.org/MagIC/data-models/3.0}
%\url{http://earthref.org/MAGIC/metadata.htm}.

  The first line of each MagIC table looks something like this:


tab\hskip 2em{\bf table\_name}

\noindent
``tab'' (or ``tab delimited'') means that the table is tab delimited.  In theory other delimiters are possible, but {\bf PmagPy}  only  uses tab delimited formats.  The {\bf table\_name} must be one of these nine table names.

%The tables are of four general types:  EarthRef tables ({\bf er\_}) shared in common with other EarthRef databases,  MagIC tables ({\bf magic\_})  common to both rock magnetic and paleomagnetic studies, Paleomagnetic tables ({\bf pmag\_}), data reduction useful in paleomagnetic studies, Rock magnetic tables ({\bf rmag\_}), data reduction useful for rock magnetic studies.    Most studies use only some of these tables.     Here are some useful tables for a typical paleomagnetic study (starred are required in all cases):

\begin{tabular}{ll}
\hline
table\qquad &Brief description\\
\hline
{\bf contribution}\qquad & study metadata \\
{\bf locations}\qquad & location level data\\
 {\bf sites}\qquad & site level data, including geographic information, site averages of sample data, etc.\\
 {\bf samples}\qquad & sample level data, including orientation, sampling methods, sample averages of specimen data etc.\\
  {\bf specimens}\qquad & specimen level data, including interpretations of best-fit lines, planes, paleointensity, etc.\\
   {\bf measurements} \qquad &  measurement data used in the study\\
   {\bf ages}\qquad &age information.\\
   {\bf criteria}\qquad &criteria used in study for data selection\\
   {\bf images}\qquad & images associated with the study\\
   \hline
\hline
\end{tabular}


The second line of each MagIC table contains the column headers (meta-data) describing the included data.   For example, a {\bf sites} table might look like this:

{\hoffset -1in
\begin{tabular}{llllll}
\hline
tab\hskip 2em{\bf sites}\\
site \qquad & location \qquad &  lithologies \qquad & geologic\_types \qquad &  lat \qquad & lon\\
AZ01\qquad &Azores \qquad & basalt \qquad &lava flow \qquad & 37.80\qquad &-25.80\\
...\\
\hline
\end{tabular}
}

Although data can be entered directly into Excel spreadsheets by hand, it is easier to generate the necessary tables as a by-product of ordinary data processing without having to know details of the meta-data and method codes.
The section on \href{#PmagPy}{PmagPy} describes how to use the {\bf PmagPy} software for  data analysis and generate the MagIC data tables automatically for the most common paleomagnetic studies involving directions and/or paleointensities.    See also \href{#pmag_gui.py}{Pmag GUI}.


\customlink{method_codes}

  \section{A word about  method codes}

  The MagIC database tags records with ``method codes'' which are short codes that describe various methods associated with a particular data record.  The complete list is available here:  \url{https://earthref.org/MagIC/method-codes}.      Most of the time, you do not need to know what these are (there are over a hundred!), but it is helpful to know something about them.  These are divided into several general categories like `geochronology methods' and  `field sampling methods'.   Method codes start with a few letters which designate the category (e.g., GM or FS  for geochronogy and field sampling respectively).   Then there is a second part and possibly also a third part to describe methods with lesser or greater detail.
This table lists method codes describing various lab treatment methods to give you a flavor for how the codes work:

   \begin{tabular}{lll}
  \hline
  LT-AF-D \qquad & Lab Treatment \qquad & Alternating field: Double demagnetization\\
  \qquad &\qquad & with AF along X,Y,Z measurement \\
 \qquad &\qquad & followed by AF along -X,-Y,-Z measurement\\
LT-AF-G \qquad & Lab Treatment \qquad & Alternating field: Triple demagnetization\\
\qquad &\qquad & with AF along Y,Z,X measurement\\
\qquad &\qquad & followed by AF along Y and AF along Z measurement\\
LT-AF-I \qquad & Lab Treatment \qquad & Alternating field: In laboratory field\\
LT-AF-Z \qquad & Lab Treatment \qquad & Alternating field: In zero field\\
LT-CHEM \qquad & Lab Treatment \qquad & Cleaning of porous rocks by chemical leaching with HCl\\
LT-FC \qquad & Lab Treatment \qquad & Specimen cooled with laboratory field on\\
LT-HT-I \qquad & Lab Treatment \qquad & High temperature treatment: In laboratory field\\
LT-HT-Z \qquad & Lab Treatment \qquad & High temperature treatment: In zero field\\
LT-IRM \qquad & Lab Treatment \qquad & IRM imparted to specimen prior to measurement\\
LT-LT-I \qquad & Lab Treatment \qquad & Low temperature treatment: In laboratory field\\
LT-LT-Z \qquad & Lab Treatment \qquad & Low temperature treatment: In zero field\\
LT-M-I \qquad & Lab Treatment \qquad & Using microwave radiation: In laboratory field\\
LT-M-Z \qquad & Lab Treatment \qquad & Using microwave radiation: In zero field\\
LT-NO \qquad & Lab Treatment \qquad & No treatments applied before measurement\\
LT-NRM-APAR \qquad & Lab Treatment \qquad & Specimen heating and cooling: Laboratory \\
\qquad &\qquad &field anti-parallel to the NRM vector\\
LT-NRM-PAR \qquad & Lab Treatment \qquad & Specimen heating and cooling: Laboratory \\
\qquad &\qquad &field parallel to the NRM vector\\
LT-NRM-PERP \qquad & Lab Treatment \qquad & Specimen heating and cooling: \\
\qquad &\qquad &Laboratory field perpendicular to the NRM vector\\
LT-PTRM-I \qquad & Lab Treatment \qquad & pTRM tail check: After zero field step, \\
\qquad &\qquad &perform an in field cooling\\
LT-PTRM-MD \qquad & Lab Treatment \qquad & pTRM tail check: After in laboratory field step, \\
\qquad &\qquad &perform a zero field cooling at same temperature\\
LT-PTRM-Z \qquad & Lab Treatment \qquad & pTRM tail check: After in laboratory field step,\\
\qquad &\qquad & perform a zero field cooling at a lower temperature\\
LT-T-I \qquad & Lab Treatment \qquad & Specimen cooling: In laboratory field\\
LT-T-Z \qquad & Lab Treatment \qquad & Specimen cooling: In zero field\\
LT-VD \qquad & Lab Treatment \qquad & Viscous demagnetization by applying MU-metal screening\\
LP-X \qquad & Lab Treatment \qquad & Susceptibility\\
LT-ZF-C \qquad & Lab Treatment \qquad & Zero field cooled, low temperature IRM imparted\\
LT-ZF-CI \qquad & Lab Treatment \qquad & Zero field cooled, induced M measured on warming\\
\hline
\end{tabular}

\section{Uploading to MagIC}

For uploading to the database, all the individual tables can be assembled into a single file.  Each individual data table is separated from the next by a series of `$>>>>>>>>>>$' symbols, so a typical upload file might look like this:


\begin{verbatim}
tab   locations
location_type	citations	lat_n	lon_e	location	lat_s	lon_w
Drill Site	This study	19.0	156.0	801C	19.0	156.0
Drill Site	This study	19	156	801	19	156
>>>>>>>>>>
tab   samples
citations	lithologies	site	sample	geologic_types	geologic_classes
This study   Submarine Basaltic Glass	16r5113	16r5113	Lava Flow	Igneous: Extrusive
This study   Submarine Basaltic Glass	17r1026	17r1026	Lava Flow	Igneous: Extrusive
.
.
.
\end{verbatim}

Correctly formatted MagIC data tables can be assembled into a suitable upload text file by using the program \href{#upload_magic.py}{upload\_magic.py} which reads in all MagIC tables in a given directory and puts them together as in the above example.  You can invoke \href{#upload_magic.py}{upload\_magic.py} on the \href{#command_line}{command line} or call it within  \href{#pmag_gui.py}{Pmag GUI}.     \href{#upload_magic.py}{upload\_magic.py} creates a contribution file which can be \href{#magic_upload}{uploaded into the MagIC database}.  If using PmagPy to generate your upload file, \href{#upload_magic.py}{upload\_magic.py} has some nifty tricks with propagating data from one table to another, deleting unneeded columns, and so on.



%
%\section{Installing Python and PmagPy}
%\label{sect:python}
%
%
%
%Python can  be painful to install (but so can  all other programming environments).  There are  a few recipes that work for Mac OS (at least for 10.4 and later) and for Windows.  These recipes and ingredients are available through the website:
%
%\url{http://earthref.org/PmagPy}.
%
%
%
%Once Python is installed, \href{#command_line}{find your command line} with its prompt.    After the command prompt, type:  {\bf python} to start the interactive python shell.  To get back out again,   hold down the control key while typing the letter ``d''.  On Windows machines, you may have to substitute a letter ``c'' to achieve the same effect. This action will be referred to with  `ctrl-D' here.
%
% Everyone should now have the $>>>$ Python prompt.  Here is a transcript of a python interpreter session which should make a simple graph:
%
% \begin{verbatim}
% python
%Enthought Python Distribution -- www.enthought.com
%Version: 7.1-2 (32-bit)
%
%Python 2.7.2 |EPD 7.1-2 (32-bit)| (default, Jul 27 2011, 13:29:32)
%[GCC 4.0.1 (Apple Inc. build 5493)] on darwin
%Type ``packages``, ``demo`` or ``enthought`` for more information.
%>>> import matplotlib
%>>> matplotlib.use(``TkAgg``)
%>>> import pylab
%>>> pylab.plot([1,2,3,4])
%[<matplotlib.lines.Line2D object at 0x64eb270>]
%>>> pylab.show()
%
%\end{verbatim}
%
%which produces the fascinating graph:
%
%  \includegraphics[width=15cm]{EPSFiles/matplotlib.eps}
%
%
%To kill the interpreter, close the plot window (red button) and type ctrl-D.
%
%
%If you don't get something about Enthought Python, you are probably using the standard Mac Os version, which has none of the whistles and bells we want (plotting, numerical packages, etc.), and you'll need to set your path properly. Look for hints at:
%\url{http://earthref.org/PmagPy}.     For more on how to program in Python, see Chapter~\ref{chap:python}.




\customlink{survival_skills}
\chapter{Survival computer skills}
\label{ex:unix}

The `Py' part of  `PmagPy' stands for Python, the language in which all the code is written.   It is not essential, but it is helpful, to understand a bit about computer operating systems and the Python language when using PmagPy because no one should be using programs as black boxes without understanding what they are doing. As all the programs are open source, you have the opportunity to look into them.  If you understand a bit about how computers work yourself, you will be able to follow along what the programs are doing and even modify them to work better for you. In this chapter, you will find a brief introduction to the computer skills necessary for using the programs properly.  We have tried to make this tutorial operating system independent.  All the examples should work equally well on Mac OS, Windows and Unix-type operating systems.  For a more complete explanation of the marvelous world of UNIX, refer to the website at \url{http://www.tutorialspoint.com/unix/unix-quick-guide.htm}.  For handy tricks in DOS, try this link:  \url{http://www.c3scripts.com/tutorials/msdos}.
For an introduction to programming in Python, see the \href{#Python}{Python Programming Chapter}.   For now, we are interested in having the skills to find a command line and navigate the file system in order to get started with \href{#PmagPy}{PmagPy}.


\customlink{command_line}
\section{Finding your command line}
If you are not using a Unix-like computer (*NIX), you may never have encountered a command line. Using any of the command line programs requires accessing the command line.  If you are using the MacOS operating system, look for the Terminal application in the Utilities folder within the Applications folder. When the Terminal application is launched, you will get a terminal window. The Unix (and MacOS) Bash shell has a \$ sign as a prompt.  Other shells have other command line prompts, such as the antiquated `C-shell' used by Lisa Tauxe (don't ask) which has a \% prompt which is used in the examples here.

  \includegraphics[width=15cm]{EPSFiles/terminal.eps}

Under the Windows operating system, you can find your command line by searching for the ``Command Prompt'' application.

  \includegraphics[width=15cm]{EPSFiles/cmd.eps}

  Note that the location of this program varies on different computers, so you may have to hunt around a little to find yours. Also, the actual  ``prompt'' will vary for different machines.



\section{File systems}
\label{sect:file_systems}
When you first open a terminal window,  you are in your ``home'' directory.
Fundamental to all operating systems is the concept of
directories and files.  On windows-based operating systems (MacOS or Windows), directories are depicted
as ``folders'' and moving about is accomplished by clicking on the different icons.
In the world of terminal windows, the directories have names and are arranged in a hierarchical sequence with
the top directory being the ``root'' directory, known as  ``/'' (or C:\verb!\! in Windows) and the file system looks something like this:


  \includegraphics[width=15cm]{EPSFiles/filesys.eps}

 Within the root directory, there are subdirectories
(e.g. {\bf Applications} and {\bf Users} in bold face).  In any directory, there can also be ``files''
(e.g. {\it dir\_cart\_example.dat}).   To
refer to directories,  the operating system relies on what is called a ``pathname''. Every object
has an ``absolute'' pathname which is valid from anywhere on the computer.  The
absolute pathname in *NIX always begins from the root directory {\bf /} and in DOS (the operating system working in the Windows command line window), it is C:\verb!\!.

The absolute pathname to the home directory {\bf lisa} in the figure is {\bf /Users/lisa}.
Similarly, the absolute pathname to the directory containing {\bf PmagPy}
scripts  would be  {\bf /Users/lisa/PmagPy}.  There is also a ``relative'' pathname,
which is in reference to the  current directory (the one you are `sitting' in).  If user ``lisa'' is sitting in
her home directory, the relative pathname for the file {\it dir\_cart\_example.dat} in the directory
{\bf data\_files} would be {\it data\_files/dir\_cart/dir\_cart\_example.dat}.  When using relative
pathnames, it is useful to remember that {\bf ./} refers to the current
directory and {\bf ../} refers to the directory  ``above''.     Also, lisa's home directory would be $\sim$lisa, or if you are logged in as lisa yourself, then it is just $\sim$.


\customlink{file_system}
\section{Moving around in the file system}

Now that you have found your command line and are comfortable in your home directory, you can view the contents of your directory with the Unix command {\bf ls} or the DOS command {\bf dir}.
\customlink{mkdir}
You can make a new directory with the command
\begin{verbatim}
% mkdir NEW_DIRECTORY_NAME
\end{verbatim}
This command works in both Unix and DOS environments) and you can move into your new directory with the command
\begin{verbatim}
% cd NEW_DIRECTORY_NAME
\end{verbatim}
   To move back up into the home directory, just type {\bf cd ..} remembering that {\bf ..} refers to the directory above.  Also, {\bf cd} by itself will transport you home from where ever you are (there's no place like home....).     You can also change to any arbitrary directory by specifying the full path of the destination directory.


%\section {Wildcards}
%
%Unix and DOS have the ability to refer to a number of files and/or directories using
%``wildcards''.  The  wildcard for a  single character is ``?'' and for any number of
%characters is ``*''.  For example, to refer to all the files with ``.py'' in their name in the PmagPy directory in my home directory,
%I would type:
%
%\begin{verbatim}
%% ls PmagPy/*.py
%apwp.py bootams.py fishrot.py.....
%\end{verbatim}

\customlink{standard_IO}

\section {Redirecting input and output}

Programs that operate at the command line level print output to the screen and read input
from the keyboard. This is
known as ``standard input and output'' or ``standard I/O''.
One of the nicest things about working at the command line level is the ability to redirect input and output.
For example, instead of typing input to a program with the keyboard, it can
be read from a file using the symbol {\bf $<$}.   Output can either be printed to the screen (standard output), redirected into a file using the symbol {\bf $>$}, appended to the end of a file with {\bf $>>$} or
used as input to another program with the pipe operator ({\bf$ |$}).

\section{Text editors}

There are many ways of editing text and the subject is beyond the scope of this documentation. Text editing is a blessing and a curse.  You either love it or
hate it and in the beginning, and if you are used to programs like Word, you will certainly hate it. (And if you are used to a decent text editor, you will hate Word!).      But you can't use Word because the output is in a weird format that no scripting languages read easily.  So you have to use text editor that will produce a plain (ascii) file, like Notepad, TextWrangler, Sublime Text or Atom.  \href{http://textwrangler.onfreedownload.com}{TextWrangler} is free software available for Macs, Notepad comes standard in the Windows operating system and the \href{https://atom.io}{Atom} text editor is a free cross-platform option with lots of nice packages available that extend its functionality.



\customlink{Python}
\chapter{Introduction to Python Programming}
\label{chap:python}

There are many resources for learning Python, but Lisa Tauxe's \href{https://github.com/ltauxe/Python-for-Earth-Science-Students}{Python For Earth Science Students} will give you a good foundation in programming Python with geology-specific applications.  The course covers Python basics, Jupyter notebooks, and plotting and analysis with scientific Python libraries.  The entire course is freely available in a \href{https://github.com/ltauxe/Python-for-Earth-Science-Students}{Github repository}.  It is composed of an interactive series of lectures in the form of Jupyter notebooks.

To get started, you will need to \href{#getting_python}{install Python}.  Then, \href{https://git-scm.com/downloads}{download git} and follow the install instructions.  If you don't know whether you have git installed, just type \verb!git! on your command line and see if the help message appears.

\begin{enumerate}
\item \href{#getting_python}{Install Python}
\item \href{https://git-scm.com/downloads}{Download git}
\item Open your \href{#command_line}{command line}
\item Clone the notebook respoitory:
\begin{verbatim}

    git clone https://github.com/ltauxe/Python-for-Earth-Science-Students.git

    cd Python-for-Earth-Science-Students

    jupyter notebook
\end{verbatim}

\end{enumerate}
This will open a browser window with a list of Notebooks.  Click on Lecture 1, which overviews the course and teaches you how to run Notebooks.  From there, you can follow the lectures in order or pick and choose based on your interests. Python is a lot of fun - enjoy!

NB: For Anaconda-specific information, see this \href{https://docs.anaconda.com/_downloads/Anaconda-Starter-Guide-Cheat-Sheet.pdf}{handy cheat sheet} with information about how to install and update Python packages, as well as create custom Python environments and more.

\chapter{Jupyter Notebooks}
\customlink{Notebooks}
\label{chap:notebooks}

Data analysis in Python benefits from an increasingly robust ecosystem of packages for scientific computing and plotting. The Jupyter notebook is one such tool.  It has gained widespread use for conducting and presenting data analysis. Jupyter builds on the IPython project which began as a way to bring increased interactivity to data analysis in Python \citep{perez07} and has evolved to include an interactive notebook environment that seeks to enable the full trajectory of scientific computing from initial analysis and visualization, to collaboration, and through to publication. The project has expanded to enable a reproducible interactive computing environment for many other programming languages (such as R and Julia) and the language-agnostic parts of its architecture have recently been rebranded as Project Jupyter (\url{http://jupyter.org}). Jupyter notebooks allow for executable code, results, text and graphical output to coherently coexist in a single document. With these combined components, they are excellent tools both for conducting data analysis and presenting results.


%In this section, we will explain how to use {\bf PmagPy} in the notebook environment.  There are two main function libraries that the {\bf PmagPy}  programs are built from: {\bf pmag.py} and {\bf pmagplotlib.py}. The functions within these modules can  be imported and called upon within a Jupyter notebook running Python. In addition to these functions, Nick Swanson-Hysell created a module called {\bf ipmag.py} that is in active development and contains functions that replicate and extend functionality that is found within the {\bf PmagPy}  command line programs for use in the notebook environment.

To show some of what is possible in terms of data analysis using {\bf PmagPy} in a notebook environment, we have created example notebooks that are available for download from this repository: \url{https://github.com/PmagPy/2016_Tauxe-et-al_PmagPy_Notebooks}. These notebooks can also be viewed as static webpages here: \url{http://pmagpy.github.io/Example_PmagPy_Notebook.html} and \url{http://pmagpy.github.io/Additional_PmagPy_Examples.html}.

The main example notebook (Example\_PmagPy\_Notebook.ipynb) combines data from two different studies for the sake of developing a mean paleomagnetic pole from the upper portion of a sequence of volcanics in the North American Midcontinent Rift \citep{halls74, swansonhysell14}.  The two data files used within the notebook can be downloaded from the MagIC database. The digital object identifier (doi) search option allows for the data files to be readily located as  \url{https://earthref.org/MagIC/doi/10.1139/e74-113/} and \url{https://earthref.org/MagIC/doi/10.1002/2013GC005180/}. Downloading these data files from the database and putting them into folders within a local `Project Directory' allows them to be accessed within the Jupyter notebook.

Within the example notebook, these data are unpacked into their respective MagIC formatted tab delimited data files. The data are then loaded into dataframes and filtered using several different criteria (stratigraphic height and polarity).  Several functions from the {\bf ipmag} module are used for making equal area projections and calculating statistics. In addition to combining the data sets to calculate the mean pole, the code in the notebook conducts a bootstrap fold test on the data using the approach of \cite{tauxe94} as well as a common mean test. The data recombinations and calculations done in this notebook are examples of portions of the data analysis workflow which are often difficult to document and reproduce. The examples illustrate a small sliver of the potential for the use of notebooks for data manipulation and analysis of paleomagnetic data. Additional functionality available within PmagPy is demonstrated within the additional {\bf PmagPy} examples notebook (Additional\_PmagPy\_Examples.ipynb) as small vignettes of example code. Functions related to paleomagnetic and rock magnetic data analysis are shown as examples. The notebook also illustrates some of the interactivity that can be built into the notebook utilizing IPython widgets.

If you want to to run the example notebook interactively, you'll need to follow these steps:

\begin{enumerate}
\item \href{#getting_python}{Install Python and PmagPy}
\item \href{https://git-scm.com/downloads}{Download git}
\item Open your \href{#command_line}{command line}
\item Clone the notebook repository:
\begin{verbatim}

  git clone https://github.com/PmagPy/2016_Tauxe-et-al_PmagPy_Notebooks

  cd 2016_Tauxe-et-al_PmagPy_Notebooks

  jupyter notebook
\end{verbatim}
\end{enumerate}

This will open up a local IPython server in your default web browser. Click on \textit{Example\_PmagPy\_notebook.ipynb} to open and edit the main example notebook. You will see something like this:

\includegraphics[width=15cm]{EPSFiles/notebook.eps}

Notebooks are constructed as a series of `cells' which can be text or code.  To view the `source' of a text cell, just click on it.  To render it, click on the `run' button (sideways triangle on the toolbar).  Similarly, to run the code in a code cell, click on the cell and then the `run' button (or use the shift+enter short cut).   To execute the entire notebook, click on the `Cell' button and choose 'Run All'.

%A third way to acces {\bf PmagPy} inside a notebook is to set the path to the location of your downloaded PmagPy folder within the notebook itself. The default location on  MacOS is in a folder called {\it PmagPy} in your home directory (e.g., /Users/YOUR\_NAME\_HERE/PmagPy) and on Windows is in the Documents folder (e.g., 'C:\\Users\\YOUR\_NAME\_HERE\\Documents\\PmagPy\\PmagPy'. To do this you must \texttt{import os} and then have a line that reads \texttt{sys.path.insert(0, `/Users/......')} where the path reflects your own path.   If PmagPy is in your path you should be able to run the first code block which imports the {\bf PmagPy} modules and makes them availible available to use within the notebook.  The notebooks also import several other Python modules useful for scientific computing (numpy),  data manipulation (pandas) and plotting (matplotlib).

\customlink{notebook_start}
 Now you are ready to look at some data.  In the code block under the heading `Reading data from MagIC format results files',  data are read in from a file \href{#magic_download}{downloaded} and unpacked from the MagIC database.   The notebook shows how to read in the data into a \href{#pandas}{pandas DataFrame}, and plot the directions on an equal area projection:

\includegraphics[width=15cm]{EPSFiles/SnakeRiver.eps}

There are several other tricks shown off in the notebook, which should be enough to get you started using {\bf ipmag} in a Python notebook environment.  Conducting data analysis  using {\bf PmagPy} in a notebook allows for the underlying code of statistical tests to be available and for the decisions made in the specific implementation of such tests to be transparently presented.

Although there is much much more to do in Python, this documentation is aimed at getting and using {\bf PmagPy}, so that's it for this chapter. Congratulations if you made it to the end!


\customlink{trouble}
\chapter{Troubleshooting}
\label{chap:trouble}

\section{Problems with installing Python}

First, please test that you have successfully installed the correct Python distribution.

Find your command line (Terminal for Mac users, Command Prompt for Windows users) and type \texttt{python}.  You should see something like this:


\begin{verbatim}$ python
Python 3.6.0 |Anaconda 4.3.1 (x86_64)| (default, Dec 23 2016, 13:19:00)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.57)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
\end{verbatim}

If you get an error message, or you don't see ``Anaconda'' in the initial message, you should go back to the \href{#getting_python}{installing Python} section and follow the instructions there.



%\item I've installed the proper Python distribution, but PmagPy doesn't work

%There are a few possible reasons for this failure, the most common of which is that your path has not been correctly set.  To test this, type ``echo \$PATH" in your command line.

%You will see something like this:\\
%\begin{verbatim}

%/Users/****/Library/Enthought/Canopy\_64bit/User/bin: /usr/local/bin: /usr/local/share/npm/bin: /usr/bin: /bin: /usr/sbin: /sbin: /usr/local/bin: /opt/X11/bin: /Users/****/PmagPy:/usr/texbin\\
%\end{verbatim}

%Your \$PATH may look very different, but as long as you have the complete path to the PmagPy directory in there, you are golden.  If the directory is not in your path, you can try re-running the PmagPy install script, which should set your path correctly  for you.  If that doesn't work, go to your home directory (to get there, type ``cd" in your command line).  Use a text editor to open a file called .bash\_profile and add these lines:


\section{wxPython is not installed}

If you only have the core packages installed with the Anaconda distribution (plus the PmagPy package you just installed), you may get the following ImportError when attempting to execute ``eqarea.py -h'':

\begin{verbatim}
ImportError: No module named wx
\end{verbatim}

To correct this error, simply execute at the command line:
\begin{verbatim}
pip install --upgrade -f https://wxpython.org/Phoenix/snapshot-builds/ wxPython
\end{verbatim}


\section{Troubleshooting a pip install}
If you installed with pip but you have this error message or similar when you try to run a program:

\begin{verbatim} -bash: eqarea.py: command not found
\end{verbatim}

Make sure you are running the \href{#which_command}{correct command} for your operating system and {\bf PmagPy} install.

Once you have the correct command, if you still see that error message, this probably means that you have not correctly installed PmagPy.  On your command line, try:

\begin{verbatim}
pip list
\end{verbatim}

You should see both pmagpy-(version\_number) and pmagpy-cli-(version\_number) on that list.  If you don't see them, go ahead and reinstall:

\begin{verbatim}
pip install --upgrade --force-reinstall --no-cache-dir --no-deps pmagpy
pip install --upgrade --force-reinstall --no-cache-dir --no-deps pmagpy-cli
\end{verbatim}

Fully uninstalling and reinstalling can occasionally fix other problems as well!


\section{Troubleshooting a developer install}

For more information on the developer install, you can run:
\begin{verbatim}
dev_setup.py -h
\end{verbatim}

You can also check the specific \href{#getting_python}{install instructions}.

For Mac users with a developer install, it is possible that you need to make the python scripts executable. On the command line in the PmagPy/programs directory, run the command: chmod a+x *.py

\subsection{PATH for Windows}

If you are trying to get a developer install to work on Windows, and you want to set/check your \$PATH manually, see \href{http://www.mathworks.com/matlabcentral/answers/94933-how-do-i-set-my-system-path-under-windows}{Setting your Path in Windows}.  More information about adding {\bf PmagPy} to your \$PATH is available \href{#setting_path}{here}.

\subsection{PATH for OSX or Linux}
You can test if your PATH has been properly set with this command:\begin{verbatim}

  echo $PATH

\end{verbatim}

If you don't see PmagPy, PmagPy/programs, and PmagPy/programs/conversion\_scripts somewhere in the output, you have not successfully completed a developer install.

If for some reason you need to add PmagPy to your \$PATH manually, you can find more general information about setting \$PATH \href{https://stackoverflow.com/questions/14637979/how-to-permanently-set-path-on-linux-unix}{here}, and specific information about adding {\bf PmagPy} to your \$PATH \href{#setting_path}{here}.


\section{Languages other than English}
  If your computer uses multiple languages, or a language other than English, you may get an error message like this:
  \begin{verbatim}

  File ``/Applications/Canopy.app/appdata/canopy-1.7.4.3348.macosx-x86_64/Canopy.app/Contents/lib/python2.7/contextlib.py'', line 17, in __enter__
  return self.gen.next()
  File ``/Users/***/Library/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/matplotlib/__init__.py'', line 1000, in _open_file_or_url
  encoding = locale.getdefaultlocale()[1]
  File ``/Applications/Canopy.app/appdata/canopy-1.7.4.3348.macosx-x86_64/Canopy.app/Contents/lib/python2.7/locale.py'', line 543, in getdefaultlocale
  return _parse_localename(localename)
  File ``/Applications/Canopy.app/appdata/canopy-1.7.4.3348.macosx-x86_64/Canopy.app/Contents/lib/python2.7/locale.py'', line 475, in _parse_localename
  raise ValueError, 'unknown locale: %s' % localename
  ValueError: unknown locale: UTF-8
  \end{verbatim}
  Mac users can fix this by opening your .bashrc file and adding these lines:
  \begin{verbatim}
  export LC_ALL=en_US.UTF-8
  export LANG=en_US.UTF-8
  \end{verbatim}

\section{Error loading dlls (Canopy Python/Windows only)}
Some of the modules used in PmagPy have dependencies that are not called directly.  If you are missing one of those dependencies, the programs may fail in odd ways.  In general, it is worthwhile to open Canopy, go into the package manager, and update all packages.  More specifically, if you see an error message like this: \begin{verbatim}ImportError: DLL load failed: The specified procedure could not be found  \end{verbatim} you may be missing the MKL package.  Open Canopy, go to package manager, and select ``Available packages".  Scroll down to MKL, and install it.  This should fix the problem!  Note that windows users who are having trouble opening one of the GUIs should try this solution whether or not they actually see this error message.

\section{Problem with a PmagPy dependency}

{\bf PmagPy} depends on a variety of Python packages.  Sometimes you will run into problems if you have the wrong version of a dependency.  You may get an ImportError or a SyntaxError in these cases.  You can check the list of correct dependencies on \href{https://github.com/PmagPy/PmagPy/blob/master/environment.yml}{Github}.

You can see what package versions you are running by using the command ``conda list'' (or ``pip list'' if you have a non-Anaconda Python).  You can then compare with our list, and upgrade or downgrade if necessary.  For example: ``conda install pandas=0.24.2''.

\section{Problems with a specific program}
\subsection{Thellier auto\_interpreter crashes with a Segmentation Fault (on Mac).}

NB: This should no longer be a problem with matplotlib 2.0 and higher.
  \begin{itemize}
  \item This error is caused by a version issue with one of PmagPy's dependencies, matplotlib.  There are two ways to solve this problem.
  \item Recommended: upgrade matplotlib with the command ``conda upgrade matplotlib''
  \item Alternative: download and use the \href{#standalone}{standalone Pmag GUI} distribution to access Thellier GUI.
  \end{itemize}


\section{Wrong Python in Jupyter notebook}

If your jupyter notebook is calling the wrong version of python (i.e., using the OSX verion of python instead of Anaconda python), do this:

\begin{verbatim}
    unlink /usr/local/bin/python
    ln -s /Users/USERNAME/anaconda3/bin/python /usr/local/bin/python

\end{verbatim}
    and this:

\begin{verbatim}
    unlink /usr/local/bin/pythonw
    ln -s /Users/USERNAME/anaconda3/bin/pythonw /usr/local/bin/pythonw
\end{verbatim}

where USERNAME is your username.


\section{Making maps (Basemap vs. cartopy)}

In the past, {\bf PmagPy} used Basemap for all map plotting functionality.  Basemap is no longer being developed, so we have switched to cartopy.  We highly recommend that any newcomers simply follow the regular install instructions which include installing cartopy.  However, if you need to use Basemap, you can still install it:

\begin{verbatim}

    conda install --channel conda-forge basemap basemap-data-hire
\end{verbatim}

Then install the high-res data files:

\begin{verbatim}
    install_etopo.py
\end{verbatim}

By default, all pmagplotlib/ipmag functions will now use cartopy.  If you need the old Basemap version, the following functions have been preserved:

\begin{verbatim}
    pmagplotlib.plot_map_basemap
    pmagplotlib.plot_mag_map_basemap
    ipmag.plot_pole_basemap
    ipmag.plot_vgp_basemap
\end{verbatim}

To use the most up-to-date Basemap, you will need to run it in a conda env.  Otherwise, you will get a KeyError and/or a FileNotFoundError.  \href{https://medium.com/data-science-in-practice/saving-the-environment-with-anaconda-ad68e603d8c5}{This article} explains how to create and run a conda env.

All that is to say: you *can* still use Basemap, but please just use cartopy instead.

\section{Other problems}Report a problem not listed above on \href{https://github.com/PmagPy/PmagPy/issues/new}{Github}, or e-mail \href{mailto:ltauxe@ucsd.edu}{ltauxe@ucsd.edu}. Please include the following information: 1) the version of PmagPy that you are using, 2) your operating system, 3) any error messages that you got, 4) the datafile that is giving trouble, if relevant.



\begin{thebibliography}{}


\bibitem[Halls, 1974]{halls74}
Halls, H.C. (1974).
\newblock A paleomagnetic reversal in the Osler volcanic group, Northern Lake Superior.
\newblock {\em Can. J. Earth Sci.}, 11, (pp.1200-1207).


\bibitem[Paterson et~al., 2014]{paterson14}
Paterson, G., Tauxe, L., Biggin, A., Shaar, R., \& Jonestrask, L. (2014).
\newblock On improving the selection of thellier-type paleointensity data.
\newblock {\em Geochem. Geophys. Geosys.}, 15.

\bibitem[P\'{e}rez \& Granger, 2007]{perez07}
P\'{e}rez, F. \& Granger, B. (2007).
\newblock {IP}ython: a system for interactive scientific computing.
\newblock {\em Computing in Science and Engineering}, 9, 21--29.


\bibitem[Shaar et~al., 2010]{shaar10}
Shaar, R., Ron, H., Tauxe, L., Kessel, R., Agnon, A., Ben~Yosef, E., \&
  Feinberg, J. (2010).
\newblock Testing the accuracy of absolute intensity estimates of the ancient
  geomagnetic field using copper slag material.
\newblock {\em Earth and Planetary Science Letters}, 290, 201--213.

\bibitem[Shaar \& Tauxe, 2013]{shaar13}
Shaar, R. \& Tauxe, L. (2013).
\newblock Thellier\_gui: An integrated tool for analyzing paleointensity data
  from thellier-type experiments.
\newblock {\em Geochem. Geophys. Geosys.}, 14.

\bibitem[{{\it Swanson-Hysell et~al.\/}(2014){\it Swanson-Hysell, Vaughan,
  Mustain, and Asp\/}}]{swansonhysell14}
Swanson-Hysell, N.~L., A.~A. Vaughan, M.~R. Mustain, and K.~E. Asp,
\newblock Confirmation of progressive plate motion during the Midcontinent Rift's early
  magmatic stage from the Osler Volcanic Group, Ontario, Canada.
  \newblock {\em Geochem., Geophys., Geosyst.}, 15, 2039--2047, 2014.

\bibitem[Tauxe, 1998]{tauxe98}
Tauxe, L. (1998).
\newblock {\em Paleomagnetic Principles and Practice}.
\newblock Dordrecht: Kluwer Academic Publishers.

\bibitem[Tauxe et~al., 2010]{tauxe10}
Tauxe, L., Banerjee, S.~K., Butler, R., \& van~der Voo, R. (2010).
\newblock {\em Essentials of Paleomagnetism}.
\newblock Berkeley: University of California Press.

\bibitem[Tauxe et~al., 2002]{tauxe02}
Tauxe, L., Bertram, H., \& Seberino, C. (2002).
\newblock Physical interpretation of hysteresis loops: Micromagnetic modelling
  of fine particle magnetite.
\newblock {\em Geochem., Geophys., Geosyst.}, 3, DOI 10.1029/ 2001GC000280.

\bibitem[Tauxe et~al., 2003]{tauxe03b}
Tauxe, L., Constable, C., Johnson, C., Miller, W., \& Staudigel, H. (2003).
\newblock Paleomagnetism of the southwestern u.s.a. recorded by 0-5 ma igneous
  rocks.
\newblock {\em Geochem., Geophys., Geosyst.}, (pp.\ DOI 10.1029/2002GC000343).


\bibitem[Tauxe et~al., 2004]{tauxe04b}
Tauxe, L., Luskin, C., Selkin, P., Gans, P.~B., \& Calvert, A. (2004).
\newblock Paleomagnetic results from the snake river plain: Contribution to the
  global time averaged field database.
\newblock {\em Geochem., Geophys., Geosyst.}, Q08H13, doi:10.1029/2003GC000661.

\bibitem[Tauxe \& Staudigel, 2004]{tauxe04}
Tauxe, L. \& Staudigel, H. (2004).
\newblock Strength of the geomagnetic field in the cretaceous normal
  superchron: New data from submarine basaltic glass of the troodos ophiolite.
\newblock {\em Geochem. Geophys. Geosyst.}, 5(2), Q02H06,
  doi:10.1029/2003GC000635.


\bibitem[Tauxe \& Watson, 1994]{tauxe94}
Tauxe, L. \& Watson, G.~S. (1994).
\newblock The fold test: an eigen analysis approach.
\newblock {\em Earth Planet. Sci. Lett.}, 122, 331--341.


\end{thebibliography}


%\bibliography{UCPbook}
%\bibliographystyle{apalike2}


\end{document}
